
\chapter{Рекуррентные соотношения для коэффициентов ветвления представлений аффинных алгебр Ли}
\label{cha:affine-lie-algebras}
Аффинные алгебры Ли - это естественное обобщение простых конечномерных алгебр Ли. Они возникают при изучении различных физических моделей, например, моделей Весса-Зумино-Новикова-Виттена в конформной теории поля и интегрируемых спиновых цепочек. 


\section{Введение}
\label{sec:introduction}

Как было показано в разделе \ref{sec:modular-invariance}, проблема ветвления для аффинных алгебр Ли возникает в конформной теории поля, например, при построении модулярно-инвариантных статсумм  \cite{difrancesco1997cft}. Недавно проблема конформных вложений рассматривалась в работе \cite{coquereaux2008conformal}.

Существуют различные подходы к вычислению коэффициентов ветвления. Некоторые из них используют резольвенту Бернштейна-Гельфанда-Гельфанда \cite{bernstein1975differential} (См. главу \ref{cha:BGG}, алгоритм вычислений описан в работах \cite{kac1990idl},\cite{wakimoto2001idl}), ряды функций Шура \cite{fauser2006new}, когомологии БРСТ  \cite{Hwang:1994yr}, формулы Каца-Петерсона  \cite{kac1990idl,quella2002branching} или комбинаторные методы \cite{feigin707principal}.

В этой главе мы доказываем, что для произвольной редуктивной подалгебры коэффициенты ветвления описываются набором рекуррентных соотношений и существует эффективный и простой алгоритм для пошагового решения этих соотношений. Общая идея похожа на подход, предложенный в работе  \cite{ilyin812pbc} для максимальных вложений. Но в данном случае алгоритм существенно отличается, так как использует новые свойства сингулярных весов для работы с произвольными редуктивными вложениями $\af \rightarrow \gf$.

При этом важно рассматривать подалгебру  $\af$ вместе с ее ``ортогональным партнером'' $\afb\subset \gf$. 
Для любой редуктивной подалгебры $\af$ подалгебра $\afb$ регулярна и редуктивна. 

Для модуля старшего веса  $L^{\left( \mu \right)}$ и ортогональной пары подалгебр $\left(  \af, \afb \right)$ мы рассматриваем так называемый сингулярный элемент  $\Psi^{\left( \mu \right)}$ (числитель в формуле Вейля для характеров
$ch\left( L^{\mu }\right) =\frac{\Psi ^{\left( \mu \right) }}{\Psi ^{\left( 0\right) }}$,
см., например, \cite{humphreys1997introduction}), 
знаменатель Вейля $\Psi ^{\left( 0\right) }_{\afb}$ и проекцию
$\Psi ^{\left( \mu \right) }_{\left(  \af, \afb \right)}
=\pi_{\af}\frac{\Psi ^{\left( \mu \right) }_{\gf}}{\Psi ^{\left( 0\right) }_{\afb}}$.

Мы доказываем, что для произвольного $\hf$-диагонализующего модуля старшего веса $L^{\left( \mu \right)}$ и ортогональной пары $\left(  \af, \afb \right)$ элемент
$\Psi ^{\left( \mu \right) }_{\left(  \af, \afb \right)}$ допускает разложение на множество числителей Вейля $\Psi ^{\left( \mu \right) }_{ \afb }$ модулей подалгебры $\afb$.
Это разложение дает возможность построить рекуррентное соотношение для коэффициентов ветвления, соответствующих вложению $\af \rightarrow \gf $. Рекуррентное соотношение формулируется с использованием особого элемента  $\Gamma_{\af \rightarrow \gf}$ групповой алгебры
$\mathcal{E}\left( \gf \right)$, который мы называем ``веером вложения''. 
Применение этих инструментов позволяет нам сформулировать простой и явный алгоритм для вычисления коэффициентов ветвления, который может быть использован в случае произвольных (максимальных и не максимальных) подалгебр конечномерных и аффинных алгебр Ли. 
В случае максимального вложения веер имеет простую форму, сингулярный элемент становится тривиальном $\Psi ^{\left( \mu \right) }_{\left(  \af, \afb \right)}=\Psi ^{\left( \mu \right) }_{\left(  \gf\right)}$ и мы восстанавливаем соотношения, полученные ранее в работе \cite{ilyin812pbc}.

Также мы показываем, что предложенный алгоритм эффективен и может использоваться при изучении конформных вложений и coset-моделей в рациональной конформной теории поля.

В следующем разделе \ref{sec:intro-simple-lie-algebras} мы определяем аффинные алгебры Ли и приводим основные определения в теории представлений.  Заодно мы фиксируем обозначения. Затем в разделе \ref{sec:branching} мы выводим формулы разложения, основывающиеся на аномальных коэффициентах ветвления и описываем алгоритм редукции интегрируемых модулей старшего веса $L_{\mathfrak{g}}$ по отношению к редуктивной подалгебре  $\mathfrak{a}\subset \mathfrak{g}$ (см. секцию \ref{sec:algorithm}). В разделе \ref{sec:branching-examples} мы представляем различные примеры применения алгоритма для конечномерных \ref{sec:finite-dimens-lie} и аффинных алгебр Ли и обсуждаем их роль в моделях конформной теории поля \ref{sec:phys-appl}. Выводы к главе изложены в разделе \ref{sec:conclusion}. В следующей главе \ref{cha:computational-methods} описывается реализация алгоритма на языке {\it Mathematica} и приводятся дополнительные примеры вычислений.

%%  \subsubsection{Notation}
%%  \label{sec:notation}
%%  
%%  Consider affine Lie algebras $\gf$ and $\af$ with
%%  underlying finite-dimensional subalgebras $\go$ and $%
%%  \ao$ and an injection $\af\longrightarrow \frak{g%
%%  }$ such that $\af$ is a reductive subalgebra $\frak{a\subset g}$ with
%%  correlated root spaces: $\hf_{\af}^{\ast }\subset \hf_{\frak{g%
%%  }}^{\ast }$ and $\hf_{\ao}^{\ast }\subset \frak{h%
%%  }_{\go}^{\ast }$\
%%  .
%%  We use the following notations:
%%  
%%  $L^{\mu }$\ $\left( L_{\af}^{\nu }\right) $\ --- the integrable module
%%  of $\gf$ with the highest weight $\mu $\ ; (resp. integrable $\af$
%%  -module with the highest weight $\nu $ );
%%  
%%  $r$ , $\left( r_{\af}\right) $ --- the rank of the algebra $\gf$ $%
%%  \left( \mbox{resp. }\af\right) $ ;
%%  
%%  $\Delta $ $\left( \Delta _{\af}\right) $--- the root system; $\Delta
%%  ^{+} $ $\left( \mbox{resp. }\Delta _{\af}^{+}\right) $--- the positive
%%  root system (of $\gf$ and $\af$ respectively);
%%  
%%  $\mathrm{mult}\left( \alpha \right) $ $\left( \mathrm{mult}_{\af}\left(
%%  \alpha \right) \right) $ --- the multiplicity of the root $\alpha$ in $\Delta
%%  $ (resp. in $\left( \Delta _{\af}\right) $);
%%  
%%  $\co{\Delta}$ , $\left( \co{\Delta _{\af}}%
%%  \right)$ --- the finite root system of the subalgebra $\co{%
%%  \gf}$ (resp. $\co{\af}$);
%%  
%%  $\mathcal{N}^{\mu }$ , $\left( \mathcal{N}_{\af}^{\nu }\right) $ --- the
%%  weight diagram of $L^{\mu }$ $\left( \mbox{resp. }L_{\af}^{\nu }\right)
%%  $ ;
%%  
%%  $W$ , $\left( W_{\af}\right) $--- the corresponding Weyl group;
%%  
%%  $C$ , $\left( C_{\af}\right) $--- the fundamental Weyl chamber;
%%  
%%  $\bar{C}, \left(\bar{C_{\mathfrak{a}}}\right)$ --- the closure of the fundamental Weyl chamber;
%%  
%%  $\rho $\ , $\left( \rho _{\af}\right) $\ --- the Weyl vector;
%%  
%%  $\epsilon \left( w\right) :=\det \left( w\right) $ ;
%%  
%%  $\alpha _{i}$ , $\left( \beta _{j}\right) $ --- the $i
%%  $-th (resp. $j$-th) basic root for $\gf$ $\left( \mbox{resp. }\af%
%%  \right) $; $i=0,\ldots ,r$,\ \ $\left( j=0,\ldots ,r_{\af}\right) $;
%%  
%%  $\delta $ --- the imaginary root of $\gf$ (and of $\af$ if any);
%%  
%%  $\alpha _{i}^{\vee }$ , $\left( \beta _{j}^{\vee
%%  }\right) $--- the basic coroot for $\gf$ $\left( \mbox{resp. }\af%
%%  \right) $ , $i=0,\ldots ,r$ ;\ \ $\left( j=0,\ldots ,r_{\af}\right) $;
%%  
%%  $\co{\xi }$ , $\co{\xi _{\left( \af\right) }}$
%%  --- the finite (classical) part of the weight $\xi \in P$ , $\left( \mbox{%
%%  resp. }\xi _{\left( \af\right) }\in P_{\af}\right) $;
%%  
%%  $\lambda =\left( \co{\lambda };k;n\right) $ ---
%%  decomposition of the affine weight $\lambda$ indicating the finite
%%  part $\co{\lambda }$, the level $k$ and the grade $n$;
%%  
%%  $P$ $\left( \mbox{resp. } P_{\af}\right) $ \ --- the weight lattice;
%%  
%%  $m_{\xi }^{\left( \mu \right) }$ , $\left( m_{\xi }^{\left( \nu \right)
%%  }\right) $ --- the multiplicity of the weight $\xi \in P$ \ $\left( \mbox{%
%%  resp. }\in P_{\af}\right) $ in the module $L^{\mu }$ , (resp. $\xi \in
%%  L_{\af}^{\nu } $);
%%  
%%  $ch\left( L^{\mu }\right) $ $\left( \mbox{resp. }ch\left( L_{\af}^{\nu
%%  }\right) \right) $--- the formal character of $L^{\mu }$ $\left( \mbox{resp. }%
%%  L_{\af}^{\nu }\right) $;
%%  
%%  $ch\left( L^{\mu }\right) =\frac{\sum_{w\in W}\epsilon (w)e^{w\circ (\mu
%%  +\rho )-\rho }}{\prod_{\alpha \in \Delta ^{+}}\left( 1-e^{-\alpha }\right) ^{%
%%  \mathrm{{mult}\left( \alpha \right) }}}$ --- the Weyl-Kac formula;
%%  
%%  $R:=\prod_{\alpha \in \Delta ^{+}}\left( 1-e^{-\alpha }\right) ^{\mathrm{{%
%%  mult}\left( \alpha \right) }}\quad $
%%  $\left( \mbox{resp. }R_{\af}:=\prod_{\alpha \in \Delta _{%
%%  \af}^{+}}\left( 1-e^{-\alpha }\right) ^{\mathrm{mult}_{\af}\mathrm{%
%%  \left( \alpha \right) }}\right) $--- the Weyl denominator.
%%  
%%  
%%  
\section{Простые алгебры Ли, алгебра петель, центральные расширения и аффинные алгебры Ли}

\label{sec:intro-simple-lie-algebras}

{\it Алгебра Ли} $\gf$ -- это векторное пространство с билинейной операцией $[\cdot,\cdot]:\gf\otimes\gf\to \gf$, которая называется  {\it скобкой Ли или коммутатором}. Если выбрать некоторый  $X_{i}$ в $\gf$, то коммутационные соотношения можно задать при помощи  {\it структурных констант} $C_{ijk}$:
\begin{equation}
  \label{eq:1}
  [X^{i},X^{j}]=\sum_{k} C^{ij}_{k} X^{k}
\end{equation}

Алгебра Ли называется {\it простой} если она не содержит нетривиальных идеалов относительно коммутатора. {\it Полупростая} алгебра Ли -- это прямая сумма простых алгебр Ли. В этой работе мы рассматриваем, в основном, простые и полупростые алгебры Ли.

{\it Подалгеброй Картана}  $\hfg$ называется нильпотентная подалгебра алгебры $\gf$, совпадающая со своим нормализатором. Мы обозначаем элементы базиса в $\hfg$ через $H^{i}$.

Форма Киллинга на  $\gf$ порождает невырожденную билинейную форму $(\cdot,\cdot)$ на подалгебре Картана $\hfg$, позволяющую идентифицировать $\hfg$ с подпространством дуального пространства  $\hfg^{*}$ линейных функционалов на $\hfg$. {\it Веса}  -- это элементы  $\hfg^{*}$, мы обозначаем их греческими буквами $\mu,\nu, \omega, \lambda\dots$


Коммутационные соотношения  (\ref{eq:1}) можно записать в компактной форме, если выбрать базис специальным образом. Такой базис описывается корневой системой, которая определяется в разделе \ref{sec:weights-roots} (Смотри также \cite{humphreys1997introduction,humphreys1992reflection}).

Чтобы определить аффинные алгебры нам нужно обсудить процедуру центрального расширения алгебры Ли.
Напомним несколько определений (см \cite{fuks1986cohomology},\cite{fuks1984}, \cite{feigin1988}).
\begin{definition}
Будем рассматривать алгебру Ли $\gf$ над полем $k=\mathbb{C},\mathbb{R}$. Векторное пространство $A$ над полем $k$ называется {\it модулем над $\gf$} или {\it $\gf$-модулем}, если задано билинейное отображение $\mu:\gf\times A\to A$, такое что $\mu([X,Y],a)=\mu(X,\mu(Y,a))-\mu(Y,\mu(X,a))$ для $X,Y\in \gf, a\in A$. Далее мы будем опускать символ $\mu$ и писать $X a= \mu(X,a)$.
\end{definition}
\begin{definition}
  {\it $n$-мерная коцепь с коэффициентами в $A$} -- это кососимметричный $n$-линейный функционал на $\gf$ со значениями в $A$. Пространство $n$-коцепей $C^{n}(\gf;A)=\mathrm{Hom}(\wedge^{n}\gf;A)$.
\end{definition}
Заметим, что элементы $\gf$ действуют на $C^{n}(\gf;A)$.
\begin{definition}
  Внешний дифференциал $d=d_{n}:C^{n}(\gf;A)\to C^{n+1}(\gf;A)$ определяется формулой
  \begin{multline}
    \label{eq:1}
    (dc) (X_{1},\dots, X_{n+1})=\sum_{1\leq s<t\leq n+1} (-1)^{s+t-1} c([X_{s},X_{t}],X_{1},\dots,\hat X_{s},\dots,\hat X_{t},\dots X_{n+1})\\
    +\sum_{1\leq s\leq n+1} (-1)^{s}X_{s} c(X_{1},\dots \hat X_{s},\dots X_{n+1})
  \end{multline}
\end{definition}
Нетрудно проверить, что последовательность
\begin{equation}
  \label{eq:2}
  \dots\stackrel{d_{n}}{\longleftarrow} C^{n}(g;A)\stackrel{d_{n-1}}{\longleftarrow} C^{n-1}(\gf;A)\leftarrow \dots \leftarrow C^{1}(\gf;A) \stackrel{d_{0}}{\longleftarrow} C^{0}(\gf;A)\leftarrow 0
\end{equation}
точна.Тогда $\{C^{n}(\gf;A),d_{n}\}=C^{*}(\gf;A)$ есть комплекс.
\begin{definition}
Соответствующие когомологии называются {\it когомологиями алгебры $\gf$ с коэффициентами в $A$} и обозначаются через $H^{n}(\gf;A)=\mathrm{Ker}\; d_{n}/\mathrm{Im}\; d_{n-1}$. 
  
\end{definition}
Заметим, что поле $k$ может рассматриваться как тривиальный $\gf$-модуль. В этом случае второй член в формуле \eqref{eq:1} исчезает и используют сокращенные обозначения $C^{n}(\gf), H^{n}(\gf)$.
\begin{definition}
  Определим, заодно, и гомологии. Пространство $n$-мерных цепей $C_{n}(\gf;A)=A\otimes \wedge^{n}\gf$, дифференциал $\partial=\partial_{n}:C_{n}(\gf;A)\to C_{n-1}(\gf;A)$ определяется формулой
  \begin{multline}
    \label{eq:3}
    \partial(a\otimes (X_{1}\wedge \dots \wedge X_{n})) =\\ \sum_{1\leq s<t\leq n+1} (-1)^{s+t-1} a\otimes ([X_{s},X_{t}]\wedge X_{1} \wedge\dots\wedge\hat X_{s}\wedge \dots\wedge \hat X_{t}\wedge \dots\wedge X_{n+1})\\
    +\sum_{1\leq s\leq n+1} (-1)^{s}(X_{s} a)\otimes (X_{1}\wedge\dots\wedge \hat X_{s}\wedge\dots\wedge X_{n+1})
  \end{multline}
  Аналогично определяется точная последовательность, комплекс и группа гомологий $H_{n}(\gf;A)$.
\end{definition}
\begin{definition}
  {\it Одномерным центральным расширением алгебры $\gf$ } называется точная последовательность
  \begin{equation}
    \label{eq:4}
    0\to k \to \tilde \gf\to \gf\to 0,
  \end{equation}
  такая что образ $k\to \tilde\gf$ содержится в центре $\tilde\gf$.
\end{definition}
Заметим, что всякий 2-коцикл $c\in C^{2}(\gf;A)$ определяет центральное расширение $\gf$:
\begin{equation}
  \label{eq:5}
  0\to k\stackrel{\lambda\to (0,\lambda)}{\longrightarrow}\tilde\gf=\gf\oplus k \stackrel{(X,\lambda)\to X}{\longrightarrow} \gf\to 0
\end{equation}
Скобка Ли в алгебре $\tilde\gf$, которая равна $\gf\oplus k$ как векторное пространство, определяется равенством
\begin{equation}
  \label{eq:6}
  [(X,\lambda),(Y,\mu)]=([X,Y],c(X,Y))
\end{equation}
Тождество Якоби для такой скобки равносильно тому, что $c$-- 2-коцикл. Когомологичным коциклам отвечают эквивалентные расширения. 

Два расширения $\tilde \gf$ и $\tilde{\tilde\gf}$ называются эквивалентными, если существует изоморфизм $I:\tilde\gf\to \tilde{\tilde \gf}$ такой, что диаграмма коммутирует:
\begin{equation}
  \label{eq:7}
  \begin{diagram}
    \node 0 \arrow{e,t}{}  \node{\gf} \arrow{e,t}{} \arrow{s,l}{id} \node{\tilde\gf}\arrow{s,l}{I} \arrow{e,t}{} \node{k}\arrow{s,r}{id} \arrow{e,t}{} \node{0}\\
    \node 0 \arrow{e,t}{}  \node{\gf} \arrow{e,t}{} \node{\tilde{\tilde\gf}} \arrow{e,t}{} \node{k} \arrow{e,t}{} \node{0}
  \end{diagram}
\end{equation}
%% \begin{exercise}
%%  Построить изоморфизм $I$.   
%% \end{exercise}


Таким образом пространство $H^{2}(\gf)$ -- это множество классов 1-мерных центральных расширений $\gf$. Нуль в $H^{2}(\gf)$  соответствует тривиальному расширению. 

Вернемся к алгебре Витта \eqref{eq:230}. Существует коцикл
\begin{equation}
  \label{eq:8}
  c(l_{n},l_{m})=\frac{1}{12}(m^{3}-m)\delta_{-n,m}
\end{equation}
%% \begin{exercise}
%%   Проверить, что $c$ -- коцикл алгебры Витта. 
%% \end{exercise}
Соответствующее центральное расширение алгебры Витта называется алгеброй Вирасоро. Коммутационные соотношения этой алгебры имеют вид
\begin{eqnarray}
  \label{eq:9}
  [L_{n},c]=0\\
  \left[L_{n},L_{m}\right]=(n-m)L_{n+m} +\frac{c}{12} (m^{3}-m) \delta_{-n,m}
\end{eqnarray}
Можно показать, что $H^{2}(Witt)\cong \mathbb{C}$ и все нетривиальные коциклы пропорциональны $c$. 
(Доказательство есть в \cite{fuks1986cohomology}, \cite{schottenloher2008mathematical}).

{\it Алгебра петель} $L\gf=\gf\otimes \mathbb{C}[t,t^{-1}]$, соответствующая полупростой алгебре Ли $\gf$, определяется коммутационными соотношениями
\begin{equation}
  \label{eq:6}
  [X^{i}t^{n},X^{j}t^{m}]=t^{n_+m}\sum_{k}C^{ij}_{k}X^{k}
\end{equation}
Центральное расширение алгебры петель ведет к возникновению дополнительного члена
\begin{equation}
  \label{eq:7}
   [X^{i}t^{n}+\alpha c,X^{j}t^{m}+\beta c]=t^{n+m}\sum_{k}C^{ij}_{k}X^{k}+(X^{i},X^{j})n\delta_{n+m,0}c
\end{equation}
Эта алгебра $\hat\gf=\gf\otimes\mathbb{C}[t,t^{-1}]\oplus\mathbb{C}c$ называется (не скрученной)  {\it аффинной алгеброй Ли} \cite{kac1990idl}, \cite{wakimoto2001idl,wakimoto2001lectures}, \cite{kass1990ala}.

\subsection{Модули, веса и корни}
\label{sec:weights-roots}

Пусть $\gf$ -- конечномерная или аффинная алгебра Ли.  $\gf$-модулем называется векторное пространство $V$ с билинейным отображением $\gf \times V\to V$, таким, что выполнено равенство
\begin{equation}
  \label{eq:2}
  [x,y]\cdot v = x\cdot(y\cdot v) - y\cdot(x\cdot v), \quad \mbox{for}\; x,y\in \gf, v\in V
\end{equation}
Представление алгебры  $\gf$ на векторном пространстве $V$ называется гомоморфизм $\gf\to gl(V)$ из $\gf$ в алгебру Ли эндоморфизмов векторного пространства $V$, где скобка задана коммутатором.

В произвольном представлении операторы, соответствующие генераторам подалгебры Картана $H^{i}$ можно одновременно диагонализовать путем специального выбора базиса
 $\{v_{j}\}$ в $V$:
\begin{equation}
  \label{eq:3}
  H^{i}\cdot v_{j}=\nu_{j}^{i}v_{j}
\end{equation}
Собственные значения $\nu^{i}_{j}$ генераторов Картана на элементе базиса $v_{j}$ определяют вес  $\nu_{j}\in \hfg^{*}$, такой, что $\nu_{j}(H^{i})=\nu_{j}^{i}$. Вектор $v\in V$ называется весовым вектором веса  $\lambda$, если $H v=\lambda_{j}(H)v,\; \forall H\in \hf$. Весовое подпространство состоит из всех весовых векторов $V_{\lambda}=\{v\in V: H v=\lambda_{j}(H)v,\; \forall H\in \hf\}$. Кратностью веса  $m_{\lambda}=\mathrm{mult}(\lambda)=\mathrm{dim} V_{\lambda}$ называется размерность весового подпространства.

Структура модуля определяется набором весов, так как действие генераторов $E^{\alpha}$ на весовых векторах дается выражением
\begin{equation}
  \label{eq:5}
  E^{\alpha}\cdot v_{\lambda} \propto v_{\lambda+\alpha}
\end{equation}
Структуру модуля можно записать в виде формального характера
\begin{equation}
  \label{eq:10}
  \mathrm{ch}V=\sum_{\lambda}m_{\lambda} e^{\lambda}
\end{equation}
Характер  $\mathrm{ch}V\in \mathcal{E}$ -- это элемент алгебры  $\mathcal{E}$, порожденной формальными экспонентами весов. Характер можно специализировать --- взять его значение на некотором элементе $\xi\in\hf$.

Алгебра Ли является собственным модулем по отношению к специальному представлению, называющемуся присоединенном. Действие генераторов в этом представлении дается скобкой $ad_{X} Y=[X,Y]$. 
{\it Корни} -- это веса присоединенного представления алгебры $\gf$.  Они определяют коммутационные соотношения в алгебре следующим образом. Обозначим через $\Delta$ множество корней. Для каждого $\alpha\in \Delta$ существует корень  $-\alpha\in \Delta$ и генераторы $E^{\alpha}, E^{-\alpha}$, такие, что
\begin{align}
  \label{eq:4}
  &  [H^{i},E^{\alpha}]=\alpha^{i}E^{\alpha} \\
  &\left[E^{\alpha},E^{\beta}\right]=
  \begin{cases}
    N_{\alpha,\beta} E^{\alpha+\beta}, & \mbox{if}\; \alpha+\beta\in \Delta\\
    \frac{2}{(\alpha,\alpha)} \sum_{i}\alpha^{i} H^{i},&  \mbox{if}\; \alpha=-\beta\\
    0,&\mbox{в остальных случаях}
  \end{cases}
\end{align}

В корневой системе $\Delta$ можно выбрать множество положительных корней. Это подмножество  $\Delta^{+}\subset \Delta$, такое, что для любого корня $\alpha\in\Delta$ ровно один из корней $\alpha, -\alpha$ содержится $\Delta^{+}$ и для любых двух различных положительных корней $\alpha, \beta\in \Delta^{+}$, таких, что $\alpha+\beta\in \Delta$ их сумма тоже положительна $\alpha+\beta\in\Delta^{+}$.
Элементы множества $-\Delta^{+}$ называются отрицательными корнями.

Положительный корень называется {\it простым} если его нельзя представить в виде суммы положительных корней. Множество простых корней  $\Phi=\left\{\alpha_{i}\right\}$ является базисом в $\hfg^{*}$ и каждый корень может быть записан как сумма $\alpha=\sum_{i}n_{i}\alpha_{i}$, где все $n_{i}$ не отрицательны или не положительны одновременно. В случае конечномерной алгебры Ли  $\gf$ простые корни можно пронумеровать числами от  1 до ранга алгебры $i=1,\dots,r,\quad r=\mathrm{rank}(\gf)$. Такая нумерация порождает лексикографическое упорядочение корневой системы. Старший по отношению к этому упорядочению корень обозначается через $\theta=\sum_{i=1,\dots,r} a_i \alpha_i$, его координаты в базисе простых корней $a_i$ называются  {\it марками}. $\theta$ -- это старший вес присоединенного модуля (См. раздел \ref{sec:high-weight-modul}). {\it Ко-марками} называются числа, равные $a_i^{\vee}=\frac{(\alpha_i,\alpha_i)}{2} a_i$.

В аффинной алгебре Ли  $\hat\gf$ множество корней  $\Delta$ бесконечно, но набор простых корней  $\Phi$ конечен. Обозначим его элементы через $\alpha_{0},\dots \alpha_{r}$, где $r=\mathrm{rank}(\gf)$. Корни $\alpha_1,\dots, \alpha_r$ -- это корни соответствующей конечномерной алгебры Ли $\go$. Простой корень  $\alpha_0=\delta-\theta$ -- это разность  {\it мнимого корня} $\delta$ и $\theta$ -- старшего корня алгебры $\go$.
Заметим, что кратность корня  $\mathrm{mult}(\alpha)$ в случае аффинной алгебры Ли может быть больше единицы.

Подалгебра  $\bff_{+}\subset \gf$, порожденная генераторами $H^{i}, E^{\alpha}$, соответствующими положительным корням $\alpha\in \Delta^{+}$, называется подалгеброй Бореля.

{\it Параболическая подалгебра}  $\pf_{I}\supset \bff_{+}$ содержит подалгебру Бореля и порождена некоторым подмножеством простых корней  $\{\alpha_{j}:j\in I, I\subset \{1\dots r\}\}$. Она образована подмножеством генераторов  $\{H^{i}\}\cup \{E^{\alpha}:\alpha\in \Delta^{+}\}\cup \{E^{-\alpha}: \alpha\in\Delta^{+}, \alpha=\sum_{j\in I} n_{j} \alpha_{j}\}$.
{\it Регулярная подалгебра} $\af\subset\gf$ определяется корневой системой  $\Delta_{\af}$, множество простых корней которой  $\{\beta_{i}, i=1,\dots,r_{\af}\}$ является подмножеством множества $\{\alpha_{1},\dots,\alpha_{r}\}\cup \{-\theta\}$ корней алгебры $\gf$.

 {\it Группа Вейля} $W_{\gf}$ порождается отражениями $\{s_{i}:\hfg^{*}\to\hfg^{*}\}$, соответствующим простым корням $\{\alpha_{i}\}$:
\begin{equation}
  \label{eq:8}
  s_{i}\cdot\lambda=\lambda-\frac{2(\alpha_{i},\lambda)}{(\alpha_{i},\alpha_{i})}\alpha_{i}
\end{equation}
Корневая система и характеры представлений инвариантны относительно действия группы Вейля. Корневая система может быть восстановлена из множества простых корней в результате применения вейлевских отражений.

Группа Вейля конечна для конечномерных алгебр Ли и конечно порождена для аффинных алгебр Ли.

Рассмотрим действие элемента группы Вейля $s_{\alpha}s_{\alpha+\delta}$ аффинной алгебры Ли   $\hat\gf$, соответствующего простому корню  $\alpha$ конечномерной подалгебры Ли $\gf$. Из определения  \eqref{eq:8} легко видеть, что $s_{\alpha}s_{\alpha+\delta} \cdot \lambda=\lambda+\frac{2}{(\alpha,\alpha)}\alpha+\left(\frac{(\alpha,\alpha)}{2 (\lambda,\delta)}+(\lambda,\alpha)\right) \delta$. То есть группа Вейля для аффинной алгебры Ли может быть представлена как полупрямое произведение группы Вейля $W_{\gf}$ конечномерной подалгебры  $\gf$ и трансляций, соответствующих корням $\gf$. 

Элемент группы Вейля можно представить как произведение простых отражений различными способами. Число простых отражений в кратчайшей последовательности, представляющей элемент$w\in W_{\gf}$ называется {\it длиной}  $w$ и обозначается $l(w)$. Мы также используем обозначение $\epsilon(w)=(-1)^{l(w)}$ для четности числа отражений Вейля, порождающих $w$. 

Фундаментальная область $\bar{C}$ для действия группы Вейля $W_{\gf}$ на $\hfg^{*}$ описывается условием $\xi\in \bar{C}\Leftrightarrow (\xi,\alpha_{i})\geq 0$ для всех простых корней $\alpha_{i}$. Ее называют {\it главной камерой Вейля}. 

{\it Матрица Картана} $A$ строится из произведений простых корней
\begin{equation}
  \label{eq:9}
  A_{ij}=\frac{2(\alpha_{i},\alpha_{j})}{(\alpha_{j},\alpha_{j})}.
\end{equation}
Она может использоваться для компактного описания алгебры Ли и ее коммутационных соотношений в базисе Шевалле \cite{humphreys1997introduction}, \cite{fulton1991representation}, \cite{bourbaki2002lie}.

Форма, заданная матрицей Картана \eqref{eq:9} определяет базис, дуальный к базису простых корней.  Он называется  {\it базисом фундаментальных весов}. Мы обозначаем его элементы через $\omega_i$:
\begin{equation}
  \label{eq:20}
  \langle\omega_i,\alpha_j\rangle=\frac{2(\omega_{i},\alpha_{j})}{(\alpha_{j},\alpha_{j})}=\delta_{ij}
\end{equation}
Для конечномерной алгебры Ли существует $r$ фундаментальных весов $\omega_{i}$, $i=1,\dots, r$. Для аффинной алгебры Ли есть дополнительный фундаментальный вес $\omega_0=\lambda$, $(\lambda,\delta)=1, \; (\lambda,\lambda)=(\delta,\delta)=0$. Другие фундаментальные веса равны $\omega_i=a_i^v \omega_0 +\co{\omega_i}$, где $\co{\omega_i}$ -- это фундаментальные веса конечномерной подалгебры Ли $\gf$.

Сумма фундаментальных весов $\rho=\sum_{i} \omega_{i}$ называется {\it вектором Вейля} и играет большую роль в теории представлений.

\subsection{Модули старшего веса}
\label{sec:high-weight-modul}

Мы рассматриваем конечно-порожденные  $\gf$-модули $V$, такие, что $V=\bigoplus_{\xi\in \hfg^{*}} V_{\xi}$, где каждое подпространство $V_{\xi}$ конечномерно и существует конечный набор весов $\lambda_{1},\dots \lambda_{s}$, порождающий весовую систему модуля $V$. То есть, если $\mathrm{dim}V_{\xi}\neq 0$, то $\xi=\lambda_{i}-\sum_{k=1,\dots, r} n_{k}\alpha_{k}$, где $n_{k}\in \mathbb{Z}_{+}$ (См.  \cite{humphreys2008representations}, \cite{carter2005lie}).

Модули старшего веса содержат единственный старший вес $\mu$ и все остальные веса в них могут быть получены вычитанием линейных комбинаций простых корней $\lambda=\mu-n_{1}\alpha_{1}-\dots-n_{r}\alpha_{r},\; n_{k}\in \mathbb{Z} _{+}$.

Самый простой тип модулей старшего веса -- это модули Верма $M^{\mu}$. Модуль Верма можно определить, как пространство
\begin{equation}
  \label{eq:17}
  M^{\mu}=U(\gf)\underset{U(\bff_{+})}{\otimes} D^{\mu}(\bff_{+}),
\end{equation}
где действие $\gf$ дается умножением в $U(\gf)$, а
$\underset{U(\bff_{+})}{\otimes}$ значит, что действие элементов $U(\bff_{+})$ ``проносится'' через левую часть тензорного произведения направо. Здесь $\bff_{+}$ -- подалгебры Бореля, а $D^{\mu}(\bff_{+})$ -- представление $\bff_{+}$, такое, что $D(E^{\alpha})=0,\; D(H)=\mu(H)$ для любого положительного корня $\alpha$.
Элементы  $\gf$ действуют слева и мы должны прокоммутировать все элементы $\bff_{+}$ направо, чтобы они могли подействовать на пространстве $D^{\lambda}(\bff_{+})$.

Кратности весов в модуле Верма можно определить из формулы Вейля для характеров
\begin{equation}
  \label{eq:11}
  \mathrm{ch} M^{\mu}=\frac{e^{\mu}}{\prod_{\alpha\in \Delta^{+}} \left( 1-e^{-\alpha}\right)^{\mathrm{mult}(\alpha)}}=\frac{e^{\mu}}{\sum_{w\in W} \epsilon(w) e^{w\rho-\rho}}
\end{equation}
Здесь мы воспользовались тождеством Вейля для знаменателей
\begin{equation}
  \label{eq:12}
  R:=\prod_{\alpha\in \Delta^{+}} \left( 1-e^{-\alpha}\right)^{\mathrm{mult}(\alpha)}=\sum_{w\in W} \epsilon(w) e^{w\rho-\rho},
\end{equation}
а $\epsilon \left( w\right) :=\det \left( w\right)$ равняется четности последовательности отражений Вейля, образующих $w$.

У модуля Верма  $M^{\mu}$ есть единственный максимальный подмодуль и нетривиальный фактормодуль $L^{\mu}$ является 
{\it неприводимым модулем старшего веса}. 

Неприводимые модули старшего веса не имеют нетривиальных подмодулей. 
Формула Вейля для характеров неприводимых модулей старшего веса имеет вид
\begin{equation}
  \label{eq:13}
  \mathrm{ch} L^{\mu}=\frac{\sum_{w\in W} \epsilon(w) e^{w(\mu+\rho)-\rho}}{\sum_{w\in W}\epsilon(w) e^{w\rho-\rho}}=\sum_{w\in W} \epsilon(w)\; \mathrm{ch} M^{w(\mu+\rho)-\rho}
\end{equation}
То есть характер неприводимого модуля старшего веса можно рассматривать как комбинацию характеров модулей Верма. Этот факт следует из существования резольвенты Бернштейна-Гельфанда-Гельфанда \cite{bernstein1976category,bernstein1971structure}, см. также
\cite{humphreys2008representations}.

Конструкция обобщенного (или параболического) модуля Верма аналогична формуле (\ref{eq:17}), но представление подалгебры Бореля заменяется на представление параболической подалгебры $\pf_{I}\supset \bff_{+}$, определяющейся некоторым подмножеством  $\{\alpha_{I}\}$ простых корней $I\subset \{1,\dots, r\}$:
%% !!! \Delta_{p}?!
\begin{equation*}
M_{I}^{\mu}=U\left( \gf\right)\otimes _{U\left( \pf_{I}\right) }L_{\pf_{I}}^{\mu}.
\end{equation*}
Введем формальный элемент $R_{I}:=\prod_{\alpha \in \Delta
^{+}\setminus \Delta _{\pf_{I}}^{+}}\left( 1-e^{-\alpha }\right)
^{\mathrm{mult}(\alpha )}$. Тогда характер обобщенного модуля Верма можно записать в виде
\begin{equation}
  \label{eq:18}
  \mathrm{ch}M_{I}^{\mu}=\frac{1}{R_{I}}\mathrm{ch}L_{\pf_{I}}^{\mu }.
\end{equation}

%% Define external border of irreducible representation here

Формула Вейля для характеров может быть использована для получения рекуррентных соотношений на кратности весов. Эти соотношения важны для вычислений \cite{il2010folded,kulish4sfa}. 

Для неприводимых модулей старшего веса рекуррентные соотношения имеют вид
\begin{equation}
\label{eq:14}
m_{\xi }=-\sum_{w\in W\setminus e}\epsilon (w)m_{\xi
-\left( w(\rho )-\rho \right) }+\sum_{w\in W}\epsilon
(w)\delta _{\left( w(\mu +\rho )-\rho \right) ,\xi }.
\end{equation}
Формулы для модулей Верма и обобщенных модулей Верма отличаются только во вторым членом в правой части. В случае модулей Верма он равен $\delta_{\xi,\mu}$. Для обобщенного модуля Верма суммирование во втором члене в правой части равенства \eqref{eq:14} производится по элементам подгруппы Вейля порожденной отражениями, соответствующими корням $\{\alpha_{I}\}$.

В разделе \ref{subsec:Construct-recurrent-rel} мы покажем, что для модулей старшего веса эти соотношения могут быть получены как частный случай рекуррентных соотношений на коэффициенты ветвления.

Другая рекуррентная формула для кратностей может быть получена из рассмотрения действия элементов Казимира на неприводимых модулях старшего веса \cite{humphreys1997introduction}:
\begin{equation}
  \label{eq:15}
  m_{\lambda}=\frac{2}{(\mu+\rho)^{2}-(\lambda+\rho)^{2}}\sum_{\alpha\in \Delta^{+}}\sum_{k\geq 1} (\lambda+k\alpha,\alpha)m_{\lambda+k\alpha}.
\end{equation}
Эта формула называется формулой Фрейденталя. Заметим, что она применима только для неприводимых модулей

Применение рекуррентных соотношений \eqref{eq:14} и \eqref{eq:15} для вычисления кратностей весов обсуждается в разделе \ref{sec:comp-algor}. 

\section{Рекуррентные соотношения для коэффициентов ветвления}
\label{sec:branching}

Рассмотрим интегрируемый модуль $L^{\mu }$ алгебры $\gf$ со старшим весом  $\mu$ и пусть  $\af\subset\gf$ -- редуктивная подалгебра $\gf$. Модуль $L^{\mu}$ полностью приводим по отношению к $\af$.
\begin{equation*}
 L_{\gf\downarrow \af}^{\mu }=\bigoplus
\limits_{\nu \in P_{\af}^{+}}b_{\nu }^{\left( \mu \right) }L_{\af}^{\nu }.
\end{equation*}
Используем оператор проекции  $\pi_{\af}$ (на весовое пространство $\hf_{\af}^*$) и перепишем это разложение в терминах формальных характеров:
\begin{equation}
\label{branching1}
 \pi _{\af}\circ ch\left( L^{\mu }\right)
 =\sum_{\nu \in P_{\af}^{+}}b_{\nu }^{(\mu)}ch\left( L_{\af}^{\nu }\right) .
\end{equation}
Нас интересуют коэффициенты ветвления $b^{(\mu)}_{\nu}$.

\subsubsection{Ортогональная подалгебра и веер вложения.}
\label{subsec:branching-orthog-pair}

В этой секции мы введем простые конструкции, которые будут полезны при изучении ветвлений. Важный объект здесь -- это ``ортогональный партнер''  $\afb$ редуктивной подалгебры $\af$ в  $\gf$.

В формуле Вейля-Каца и числитель, и знаменатель могут рассматриваться как формальные элементы, содержащие сингулярные веса модулей Верма $V^{\xi}$ со старшими весами  $\xi=\mu$ и $\xi=0$ \cite{humphreys1997introduction}.
Мы связываем сингулярные элементы с соответствующими интегрируемыми модулями  $L^{\mu }$ и $L_{\af}^{\nu }$:
\begin{equation*}
\Psi ^{\left( \mu \right) }:=\sum\limits_{w\in W}\epsilon (w)e^{w\circ (\mu +\rho )-\rho },
\end{equation*}
\begin{equation*}
\Psi _{ \af}^{\left( \nu \right) }:= \sum\limits_{w\in W_{\af}}\epsilon (w)e^{w\circ (\nu +\rho_{_{\af}})-\rho _{_{\af}}}.
\end{equation*}
и используем формулы Вейля-Каца в форме
\begin{equation}
\label{Weyl-Kac2}
ch\left( L^{\mu }\right) =\frac{\Psi ^{\left( \mu \right) }}{\Psi ^{\left( 0 \right) }}=\frac{\Psi ^{\left( \mu \right) }}{R}.
\end{equation}

Применим формулу  (\ref{Weyl-Kac2}) к правилу ветвления (\ref{branching1}) и получим соотношение, связывающее сингулярные элементы
 $\Psi ^{\left( \mu \right) }$ and $\Psi _{ \af}^{\left( \nu \right) }$ :
\begin{eqnarray}
\nonumber
\pi _{\af}\left( \frac{\sum_{w \in W}\epsilon (w )e^{w
(\mu +\rho )-\rho }}{\prod_{\alpha \in \Delta ^{+}}(1-e^{-\alpha })^{\mathrm{%
mult}(\alpha )}}\right) &=&\sum_{\nu \in P_{\af}^{+}}b_{\nu }^{(\mu )}%
\frac{\sum_{w \in W_{\af}}\epsilon (w )e^{w (\nu +\rho _{%
\af})-\rho _{\af}}}{\prod_{\beta \in \Delta _{\af%
}^{+}}(1-e^{-\beta })^{\mathrm{mult}_{\af}(\beta )}},  \label{eq:4} \\
\pi _{\af}\left( \frac{\Psi ^{\left( \mu \right) }}{R}\right)
&=&\sum_{\nu \in P_{\af}^{+}}b_{\nu }^{(\mu )}\frac{\Psi _{ \frak{%
a}}^{\left( \nu \right) }}{R_{\af}}.
\end{eqnarray}
Здесь $\Delta _{\af}^{+}$ -- множество положительных корней подалгебры $\af$ (без потери общности мы можем считать их векторами из положительного корневого пространства  $\hf^{\ast  +}$ of $\gf$).

Рассмотрим корневое подпространство $\hf_{\perp \af}^{\ast }$, ортогональное к  $\af$,
\begin{equation*}
\hf_{\perp \af}^{\ast }:=\left\{ \eta \in \hf^{\ast }
|\forall h \in \hf_{\af};  \eta\left(h \right)=0 \right\} ,
\end{equation*}
и корни (соответственно -- положительные корни)  $\gf$, ортогональные
к $\af$,
\begin{eqnarray*}
\Delta _{\af_{\perp }} &:&=\left\{ \beta \in \Delta _{\gf}|
\forall h \in \hf_{\af};  \beta\left(h \right)=0  \right\} , \\
\Delta _{\af_{\perp }}^{+} &:&=\left\{ \beta ^{+}\in \Delta _{\gf%
}^{+}|\forall h \in \hf_{\af};  \beta^{+}\left(h \right)=0  \right\} .
\end{eqnarray*}
Обозначим через $W_{\afb}$ подгруппу группы Вейля $W$, порожденную отражениями $w _{\beta }$, соответствующими корням $\beta \in \Delta _{\afb}^{+}$ . Подсистема  $\Delta _{\af_{\perp }}$ определяет подалгебру $\af_{\perp }$ с подалгеброй Картана $\hf_{\afb}$. Пусть
\begin{equation*}
\hf_{\perp }^{\ast }:=\left\{ \eta \in \hf_{\perp \af}^{\ast
}|\forall h \in \hf_{\af\oplus \af_{\perp}}; \eta \left( h \right)=0 \right\},
\end{equation*}
рассмотрим подалгебры
\begin{eqnarray*}
\widetilde{\af_{\perp }} &:&=\af_{\perp }\oplus \hf_{\perp }
\\
\widetilde{\af} &:&=\af\oplus \hf_{\perp }.
\end{eqnarray*}
Алгебры $\af$ и $\af_{\perp }$ образуют ''ортогональную пару''
$\left( \af,\afb\right)$ подалгебр в  $\gf$.

Имеет место разложение подалгебры Картана
\begin{equation}
\hf=\frak{\hf_{\af}}\oplus \hf_{\af_{\perp }}\oplus
\hf_{\perp }=\frak{\hf_{\widetilde{\af}}}\oplus \hf_{%
\af_{\perp }}=\frak{\hf_{\widetilde{\af_{\perp }}}}\oplus
\hf_{\af}.
\end{equation}

Для подалгебр из ортогональной пары  $\left( \af,\afb\right) $ рассмотрим соответствующие векторы Вейля $\rho _{\af}$ и $\rho _{\af_{\perp }}$, и образуем так называемые  ''дефекты'' вложения $\mathcal{D}_{\af}$ и $\mathcal{D}_{\af_{\perp }}$ :
\begin{equation}
\mathcal{D}_{\af}:=\rho _{\af}-\pi _{\af}\rho ,
\end{equation}
\begin{equation}
\label{defect-perp}
\mathcal{D}_{\af_{\perp }}:=\rho _{\af_{\perp }}-\pi _{\af%
_{\perp }}\circ\rho .
\end{equation}

Рассмотрим сингулярные веса  $\left\{\left( w(\mu +\rho )-\rho \right)|w  \in W \right\}$  модуля старшего веса  $L_{\gf}^{\mu }$ и их проекции на $h_{\widetilde{\af_{\perp }}}^{\ast }$ (дополнительно сдвинутые на дефект $-\mathcal{D}_{\af_{\perp }}$):
\begin{equation*}
\mu _{\widetilde{\af_{\perp }}}\left( w\right) :=\pi _{\widetilde{\frak{%
a}_{\perp }}}\circ\left[ w(\mu +\rho )-\rho \right] -\mathcal{D}_{\af_{\perp
}},\quad w\in W.
\end{equation*}
Среди весов  $\left\{\mu _{\widetilde{\af_{\perp }}}\left( w\right)|w\in W\right\}$ выберем находящиеся в главной камере Вейля $\overline{C_{\widetilde{\afb}}}$ и обозначим через $U$ множество представителей $u$ классов смежности $W/W_{\af_{\perp }}$, таких что
\begin{equation}
U:=\left\{ u\in W|\quad \mu _{\widetilde{\af_{\perp }}}\left( u\right)
\in \overline{C_{\widetilde{\af_{\perp }}}}\right\} \quad .
\label{U-def}
\end{equation}
Для множества  $U$ введем веса
\begin{equation*}
\mu _{\af}\left( u\right) :=\pi _{\af}\circ\left[ u(\mu +\rho )-\rho %
\right] +\mathcal{D}_{\af_{\perp }}.
\end{equation*}
Чтобы упростить вид соотношений мы будем опускать значок "$\circ$" при записи проекций весов.

Воспользуемся техникой, предложенной в работе  \cite{ilyin812pbc} для записи рекуррентных свойств коэффициентов ветвления $b_{\nu}^{(\mu )}$. Один из инструментов в ней -- это множество весов $\Gamma_{\af\rightarrow \gf}$, называющееся веером вложения. Так как мы рассматриваем общую ситуацию (где вложение не обязательно максимально) понятие веера вложения нуждается в уточнении:
\begin{definition}
\label{fan-definition} Рассмотрим произведение
\begin{equation}
\prod_{\alpha \in \Delta ^{+}\setminus \Delta _{\afb }^{+}}\left( 1-e^{-\pi
_{\af}\alpha }\right) ^{\mathrm{mult}(\alpha )-\mathrm{mult}_{\af%
}(\pi _{\af}\alpha )}=-\sum_{\gamma \in P_{\af}}s(\gamma
)e^{-\gamma }  \label{eq:6}
\end{equation}
и носитель $\Phi _{\af\subset \gf}\subset P_{\af}$ функции $s(\gamma )=\det \left( \gamma \right) $ :
\begin{equation}
\Phi _{\af\subset \gf}=\left\{ \gamma \in P_{\af}|s(\gamma
)\neq 0\right\}   \label{eq:37}
\end{equation}
Упорядочение корней в  $\co{\Delta _{\af}}$ индуцирует натуральное упорядочение весов в $P_{\af}$. Обозначим через $\gamma_{0}$ наименьший вектор $\Phi _{\af\subset \gf}$. Множество
\begin{equation}
\Gamma _{\af\rightarrow \gf}=\left\{ \xi -\gamma _{0}|\xi \in \Phi _{%
\af\subset \gf}\right\} \setminus \left\{ 0\right\}
\label{fan-defined}
\end{equation}
называется  \textit{веером вложения}.
\end{definition}
В следующем разделе мы покажем, что веер вложения определяет рекуррентные свойства коэффициентов ветвления. Нужно отметить, что веер вложения универсален и зависит только от вложения. 

\subsubsection{Разложение сингулярного элемента.}
\label{subsec:decomp-sing-element}

Теперь покажем, что формула Вейля-Каца для характеров (в терминах сингулярных элементов) представляет собой частный случай более общего соотношения:

\begin{lemma}
\label{lemma}
Пусть $\left( \af,\afb \right)$ -- ортогональная пара редуктивных подалгебр $\gf$ и  $\widetilde{\afb}=\afb\oplus \hf_{\perp }$, $\widetilde{\af}=\af\oplus\hf_{\perp }$ ,

$L^{\mu }$ -- модуль старшего веса с сингулярным элементом $\Psi ^{\left(\mu \right)}$ ,

$R_{\af_{\perp }}$ -- знаменатель Вейля для подалгебры $\af_{\perp }$.

Тогда элемент  $\Psi ^{\left( \mu \right) }_{\left(  \af, \afb \right)}=\pi _{\af}\left( \frac{\Psi _{\gf}^{\mu }}{R_{\af_{\perp }}}\right) $ можно разложить в сумму по  $u\in U$ (см. (\ref{U-def})) сингулярных весов $e^{\mu _{\af}\left( u\right) }$ с коэффициентами $\epsilon (u)\mathrm{\dim}\left( L_{\widetilde{\afb}}^{\mu _{\widetilde{\afb}}\left( u\right) }\right) $:
\begin{equation}
\Psi ^{\left( \mu \right) }_{\left(  \af, \afb \right)}=\quad \pi _{\af}\left( \frac{\Psi^{\mu }}{R_{\af%
_{\perp }}}\right) =\sum_{u\in U}\;\epsilon (u)\mathrm{\dim }
\left( L_{\widetilde{\af_{\perp }}}^{\mu _{%
\widetilde{\af_{\perp }}}\left( u\right) }\right) e^{\mu _{\af}\left( u \right) }.
\end{equation}
\end{lemma}

\begin{proof}
Для $u\in U $ и $v\in W_{\afb}$ применим разложение
\begin{equation*}
u(\mu +\rho )=\pi _{\af } u(\mu +\rho )+\pi _{
\widetilde{\af_{\perp }} } u(\mu +\rho )
\end{equation*}
к сингулярному весу
\begin{equation}
\label{sing-decomp-1}
\begin{array}{lcl}
vu(\mu +\rho )-\rho &=&\pi _{ \af }\left( u(\mu +\rho
)\right) -\rho +\rho _{\af_{\perp }}+\pi _{ \hfb }\rho \\
&& + \ v\left( \pi _{ \widetilde{%
\af_{\perp }} }u(\mu +\rho )-\rho _{\af_{\perp }}+\rho _{%
\af_{\perp }}\right) -\rho _{\af_{\perp }} -\pi _{ \hfb }\rho.
\end{array}
\end{equation}
Используем дефект $\mathcal{D}_{\afb}$ (\ref{defect-perp}) чтобы упростить в (\ref{sing-decomp-1}) первое слагаемое :
\begin{equation*}
\begin{array}{r}
\pi _{ \af }\left( u(\mu +\rho )\right) -\rho +\rho _{%
\mathfrak{a}_{\perp }}+\pi _{ \hfb }\rho = \\
\pi _{ \af }\left( u(\mu +\rho )\right) -\pi _{\af}\rho
-\pi _{\afb}\rho +\rho _{\afb}= \\
=\pi _{ \af }\left( u(\mu +\rho )-\rho \right) +%
\mathcal{D}_{\afb},
\end{array}
\end{equation*}
и второе:
\begin{equation*}
\begin{array}{c}
v\left( \pi _{ \widetilde{%
\af_{\perp }} }u(\mu +\rho )-\rho _{\af_{\perp }}+\rho _{%
\af_{\perp }}\right) -\rho _{\af_{\perp }}-\pi _{ \hfb }\rho=\\
v\left( \pi _{ \widetilde{%
\afb} }u(\mu +\rho )
- \mathcal{D}_{\afb} - \pi _{ \afb }\rho-\pi _{ \hfb }\rho
+\rho _{\afb}\right) -\rho _{\afb}=\\
=v\left( \pi _{ \widetilde{%
\afb} }\left[ u(\mu +\rho )-\rho\right]
- \mathcal{D}_{\afb}
+\rho _{\afb}\right) -\rho _{\afb}.
\end{array}
\end{equation*}
Эти выражения представляют собой факторизацию аномального элемента  $\Psi^{\mu}$ и мы видим, что они содержат комбинации сингулярных элементов $\Psi _{\widetilde{\af_{\perp }}}^{\eta }$ модулей $L_{\widetilde{\afb}}^{\eta }$ подалгебры  $\widetilde{\afb}$:
\begin{equation*}
\begin{array}{l}
\Psi^{\mu }=\sum_{u\in U}\sum_{v\in W_{\af_{\perp }}}
\epsilon (v)\epsilon (u)e^{vu(\mu +\rho )-\rho }= \\
=\sum_{u\in U}\epsilon (u)e^{\pi _{\af}\left[ u(\mu +\rho )-\rho \right]
+\mathcal{D}_{\af_{\perp }}}\sum_{v\in W_{\af_{\perp }}}\epsilon
(v)e^{v\left( \pi _{ \widetilde{\af_{\perp }} }\left[
u(\mu +\rho )-\rho \right] -\mathcal{D}_{\af_{\perp }}+\rho _{\af%
_{\perp }}\right) -\rho _{\af_{\perp }}}= \\
=\sum_{u\in U}\;\epsilon (u)e^{\pi _{\af }\left[ u(\mu
+\rho )-\rho \right] +\mathcal{D}_{\af_{\perp }}}\Psi _{\widetilde{%
\af_{\perp }}}^{\pi _{ \widetilde{\af_{\perp }} }%
\left[ u(\mu +\rho )-\rho \right] -\mathcal{D}_{\af_{\perp }}}
\end{array}
\end{equation*}

Разделим обе части на элемент Вейля  $R_{\af_{\perp }}=\prod_{\beta \in \Delta _{\afb}}(1-e^{-\beta })^{\mathrm{mult}(\beta )}$, спроектируем их на весовое подпространство  $h_{\af}^{\ast }$ и получим итоговое соотношение:
\begin{eqnarray*}
\Psi ^{\left( \mu \right) }_{\left(  \af, \afb \right)}
&=&\sum_{u\in W/W_{\af_{\perp }}}\;\epsilon (u)e^{\pi _{\frak{a%
}}\left[ u(\mu +\rho )-\rho \right] }\pi _{%
\af}\left( \frac{\Psi _{\widetilde{\af_{\perp }}}^{\pi _{
\widetilde{\af_{\perp }} }\left[ u(\mu +\rho )-\rho \right] -%
\mathcal{D}_{\af_{\perp }}}}{\prod_{\beta \in \Delta _{\af_{\perp
}}}(1-e^{-\beta })^{\mathrm{mult}(\beta )}}\right)  \\
&=&\sum_{u\in U}\;\epsilon (u)\mathrm{\dim }\left( L_{\widetilde{\af%
_{\perp }}}^{\mu _{\widetilde{\af_{\perp }}}\left( u\right) }\right)
e^{\pi _{\af}\left[ u(\mu +\rho )-\rho \right] }.
\end{eqnarray*}
\end{proof}


\begin{remark}
Это соотношение можно рассматривать как обобщение формулы Вейля для сингулярного элемента  $\Psi _{\gf}^{\mu }$: векторы  $\mu_{\af}\left(u\right)$ играют роль сингулярных весов, но вместо определителей $\epsilon (u)$ появляются произведения  $\epsilon(u)\mathrm{\dim }\left( L_{\widetilde{\afb}}^{\mu _{\widetilde{\afb}}\left(u\right) }\right).$ Действительно, при  $\frak{a=g}$ подалгебры  $\afb$ и $\hf_{\perp }$ тривиальны, $U=W$ , и исходная формула Вейля с легкостью восстанавливается. 
\end{remark}

\subsubsection{Построение рекуррентных соотношений.}
\label{subsec:Construct-recurrent-rel}

Рассмотрим правую часть равенства (\ref{eq:4}).
Числитель описывает ветвление в терминах сингулярных элементов и, как элемент  $\mathcal{E}\left( \gf \right)$, допускает разложение в виде:
\begin{equation}
  \label{eq:21}
  \sum_{\nu \in \bar{C_{\mathfrak{a}}}}b_{\nu }^{\left( \mu \right) }\Psi _{\left( \frak{%
        a}\right) }^{\left( \nu \right) }=\sum_{\lambda \in P_{\af}}k_{\lambda
  }^{\left( \mu \right) }e^{\lambda }.
\end{equation}
Здесь $k_{\lambda}^{\left( \mu \right) }$  -- целочисленные коэффициенты, их знаки зависят от длины элементов группы Вейля в 
$\Psi _{\left( \af\right) }^{\left( \nu \right) }$. Важно заметить, что $k_{\lambda}^{\left( \mu \right) }$ совпадают с коэффициентами ветвления для всех весов $\nu$ в главной камере Вейля:
\begin{equation}
%  \label{eq:20}
  b^{(\mu)}_{\nu}=k^{(\mu)}_{\nu} \; \mbox{for} \; \nu\in \bar{C}_{\mathfrak{a}}.
\label{eq:21-1}
\end{equation}
Мы называем коэффициенты $k_{\lambda}$ сингулярными коэффициентами ветвления
(см. также \cite{ilyin812pbc}).

Теперь мы можем сформулировать основную в этой главе теорему, которая позволит нам рекуррентно вычислять коэффициенты ветвления.

\begin{theorem}
  Для сингулярных коэффициентов ветвления $k^{(\mu)}_{\nu}$ (\ref{eq:21}) выполняется соотношение
  \begin{equation}
    \label{recurrent-relation}
    \begin{array}{c}
      k_{\xi }^{\left( \mu \right) }=-\frac{1}{s\left( \gamma _{0}\right) }\left(
        \sum_{u\in U} \epsilon(u)\;
        \dim \left( L_{\widetilde{\af_{\perp }}}^{\mu
        _{\widetilde{\af_{\perp }}}\left( u\right) }\right)
        \delta_{\xi-\gamma_0,\pi_{\af}(u(\mu+\rho)-\rho)}+ \right.\\
      \left.
        +\sum_{\gamma \in
          \Gamma _{\af \rightarrow \gf}}s\left( \gamma +\gamma _{0}\right) k_{\xi
          +\gamma }^{\left( \mu \right) }\right).
    \end{array}
  \end{equation}
\end{theorem}
\begin{proof}

Redress relation (\ref{eq:4}) for the element $
\frac{\Psi _{\gf}^{\mu }}{R_{\af_{\perp }}}$ using definition (\ref{eq:37})
for the carrier $\Phi _{\af\subset \gf}$ ,
\begin{equation*}
\begin{array}{l}
\Psi ^{\left( \mu \right) }_{\left(  \af, \afb \right)}
=\pi _{\af}\left( \frac{\Psi _{\gf}^{\mu }}{R_{\af_{\perp }}}%
\right) = \\[2mm]
=\prod\limits_{\alpha \in \Delta ^{+}\setminus \Delta _{\afb }^{+}}\left(
1-e^{-\pi _{\af}\alpha }\right) ^{\mathrm{mult}(\alpha )-\mathrm{mult}_{%
\af}(\pi _{\af}\alpha )}\left( \sum\limits_{\nu \in P_{\af%
}^{+}}b_{\nu }^{(\mu )}\sum\limits_{w\in W_{\af}}\epsilon (w)e^{w(\nu
+\rho _{\af})-\rho _{\af}}\right) = \\[5mm]
=-\sum\limits_{\gamma \in \Phi _{\af\subset \gf}}s(\gamma
)e^{-\gamma }\left( \sum\limits_{\nu \in P_{\af}^{+},w\in W_{\af%
}}\epsilon (w)b_{\nu }^{(\mu )}e^{w(\nu +\rho _{\af})-\rho _{\af%
}}\right)  \\
=-\sum\limits_{\gamma \in \Phi _{\af\subset \gf}}s(\gamma
)e^{-\gamma }\left( \sum\limits_{\nu \in P_{\af}^{+},w\in W_{\af%
}}\epsilon (w)b_{\nu }^{(\mu )}e^{w(\nu +\rho _{\af})-\rho _{\af%
}}\right) .
\end{array}
\end{equation*}

Then expand the sum in brackets (with respect to the formal basis in $\mathcal{E}$%
):
\begin{equation*}
\Psi ^{\left( \mu \right) }_{\left(  \af, \afb \right)}
=-\sum_{\gamma \in \Phi _{\af\subset \gf}}s(\gamma
)e^{-\gamma }\sum_{\lambda \in P_{\af}}k_{\nu }^{(\mu )}e^{\lambda
}=-\sum_{\gamma \in \Phi _{\af\subset \gf}}\sum_{\lambda \in P_{%
\af}}s(\gamma )k_{\nu }^{(\mu )}e^{\lambda -\gamma }.
\end{equation*}
Substitute the expression obtained in Lemma \ref{lemma} (in the left-hand side),
\begin{eqnarray*}
\Psi ^{\left( \mu \right) }_{\left(  \af, \afb \right)}
&=&\sum_{u\in U}\;\epsilon (u)e^{\pi _{\af}\left( \mu _{\frak{a%
}}\left( u\right) \right) }\dim \left( L_{\widetilde{\af_{\perp }}%
}^{\mu _{\widetilde{\af_{\perp }}}\left( u\right) }\right)
\label{anom modules 2} \\
&=&\sum_{u\in U}\;\epsilon (u)e^{\pi _{\af}\left[ u(\mu +\rho )-\rho %
\right] }\dim \left( L_{\widetilde{\af_{\perp }}}^{\mu _{\widetilde{%
\af_{\perp }}}\left( u\right) }\right)  \\
&=&-\sum_{\gamma \in \Phi _{\af\subset \gf}}\sum_{\lambda \in P_{%
\af}}s(\gamma )k_{\nu }^{(\mu )}e^{\lambda -\gamma }.
\end{eqnarray*}
The immediate consequence of this equality is:
\begin{equation}
\sum_{u\in U}\epsilon (u)\dim \left( L_{\widetilde{\af_{\perp }}}^{\mu
_{\widetilde{\af_{\perp }}}\left( u\right) }\right) \delta _{\xi ,\pi _{%
\af}\left[ u(\mu +\rho )-\rho \right] }+\sum_{\gamma \in \Phi _{\af%
\subset \gf}}s(\gamma )\;k_{\xi +\gamma }^{(\mu )}=0,\quad \xi \in P_{%
\af}.  \label{eq:17}
\end{equation}
The obtained formula means that the coefficients $k_{\xi +\gamma }^{(\mu )}$
for $\gamma \in \Phi _{\af\subset \gf}$ are not independent, they
are subject to linear relations and the form of these relations changes
when the tested weight $\xi $ coincides with one of \ the ''singular
weights''  $\left\{ \pi _{\af}\left[ u(\mu +\rho )-\rho \right] |u\in
U\right\} $ . To conclude the proof we extract the lowest weight $\gamma _{0}\in \Phi _{\frak{a%
}\subset \gf}$ and pass to a summation over the vectors of the
injection fan $\Gamma _{\af\rightarrow \gf}$ (see Definition \ref
{fan-definition}). Thus we get the desired recurrent relation (\ref{recurrent-relation}).
\end{proof}

\subsubsection{Embeddings and orthogonal pairs in simple Lie algebras}
\label{sect-embeddings}

In this subsection we discuss some properties of ''orthogonal pairs'' of
subalgebras in simple Lie algebras of classical series.

When both $\gf$ and $\af$ are finite-dimensional all regular
embeddings can be obtained by a successive elimination of nodes in the
extended Dynkin diagram of $\gf$ (and $\Delta_{\afb }^{+}=\emptyset $
if $\af$ is maximal). For the classical series $A$, $C$ and $D$ when
the regular injection $\af\rightarrow \gf$ is thus fixed, the
Dynkin diagram for $\afb$ is obtained from the extended diagram
of $\gf$ by eliminating the subdiagram of $\af$ and the adjacent
nodes:
\begin{table}[tbh]
\label{tab:diagrams} \noindent \centering{\
\begin{tabular}{|l|l|l|l|}
\hline
$\gf$ & Extended diagram of $\gf$ & Diagrams of the subalgebras $%
\af,\; \afb$ &  \\ \hline
$A_n$ & \includegraphics{table1_1(l)} & \includegraphics{table1_1(r)}
&  \\ \hline
$C_n$ & \includegraphics{table1_3(l)} & \includegraphics{table1_3(r)}
&  \\ \hline
$D_n$ & \includegraphics{table1_4(l)} & \includegraphics{table1_4(r)}
&  \\ \hline
\end{tabular}
}
\caption{Subalgebras $\af,\;\afb$ for the classical series}
\end{table}


In the case of $B$ series the situation is different. The reason is that
here the subalgebra $\afb$ may be larger than the one obtained
by elimination of the subdiagram of $\af$ and the adjacent nodes. The
subalgebras of the orthogonal pair,$\ \af$ and $\afb$, must
not form a direct sum in $\gf$ . It can be directly
checked that when $\gf=B_{r}$ and $\af=B_{r_{\af}}$ the
orthogonal subalgebra is $\afb=B_{r-r_{\af}}$. Consider the
injection $B_{r_{\af}}\rightarrow B_{r},\quad 1<r_{\af}<r$. By
eliminating the simple root $\alpha _{r_{\af}-1}=e_{r_{\af%
}-1}-e_{r_{\af}}$ one splits the extended Dynkin diagram of $B_{r}$
into the disjoint diagrams for $\af=B_{r_{\af}}$ and $D_{r-r_{%
\af}}$. But the system $\Delta _{\af_{\perp }}$ contains not only
the simple roots $\left\{ e_{1}-e_{2},e_{2}-e_{3},\ldots ,e_{r_{\af%
}-2}-e_{r_{\af}-1},e_{1}+e_{2}\right\} $ but also the root $e_{r_{\frak{%
a}}-1}$. Thus $\Delta _{\af_{\perp }}$ forms the subsystem of the type $%
B_{r-r_{\af}}$ and the orthogonal pair for the injection $B_{r_{\af%
}}\rightarrow B_{r}$ is $\left( B_{r_{\af}},B_{r-r_{\af}}\right) $%
. In the next Section a particular case of such orthogonal pair is
presented for the injection $B_{2}\rightarrow B_{4}$ (see Figure \ref
{fig:dynkin}).



The complete classification of regular subalgebras for affine Lie algebras
can be found in the recent paper \cite{1751-8121-41-36-365204}. From the complete
classification of maximal special subalgebras in classical Lie algebras \cite
{dynkin1952semisimple} we can deduce the following list of pairs of
orthogonal subalgebras $\af,\;\afb$:
\begin{equation*}
\begin{array}{lll}
su(p)\oplus su(q) & \subset su(pq) &  \\
so(p)\oplus so(q) & \subset so(pq) &  \\
sp(2p)\oplus sp(2q) & \subset so(4pq) &  \\
sp(2p)\oplus so(q) & \subset sp(2pq) &  \\
so(p)\oplus so(q) & \subset so(p+q) & \mathrm{{for}\;p\;{and}\;q\;{odd}.}
\end{array}
\end{equation*}


\subsubsection{Algorithm for recursive computation of branching coefficients}

\label{sec:algorithm}

The recurrent relation (\ref{recurrent-relation}) allows us to formulate an
algorithm for recursive computation of branching coefficients. In this
algorithm there is no need to construct the module $L^{(\mu)}_{\gf}$ or
any of the modules $L^{(\nu)}_{\af}$.

It contains the following steps:

\begin{enumerate}
\item  Construct the root system $\Delta _{\af}$ for the embedding $%
\af\rightarrow \gf$.

\item  Select all positive roots $\alpha \in \Delta ^{+}$ orthogonal
to  $\af$, i.e. form the set $\Delta_{\afb }^{+}$.

\item  Construct the set $\Gamma _{\af\rightarrow \gf}$. Relation
 (\ref{eq:6}) defines the sign function
 $s(\gamma)$ and the set $\Phi_{\af\subset \gf}$ where the lowest weight
 $\gamma_0$ is to be subtracted to get the fan (\ref{fan-defined}):
 $\Gamma _{\af\rightarrow \gf}=\left\{ \xi -\gamma _{0}|\xi \in \Phi _{%
\af\subset \gf}\right\} \setminus \left\{ 0\right\}$.

\item  Construct the set $\widehat{\Psi ^{(\mu )}}=\left\{ w (\mu +\rho
)-\rho ;\;w \in W\right\} $ of singular weights for the $\gf$%
-module $L^{(\mu )}$.

\item  Select the weights $\left\{ \mu _{\widetilde{\af_{\perp }}%
}\left( w\right) =\pi _{\widetilde{\af_{\perp }}}\left[ w(\mu +\rho
)-\rho \right] -\mathcal{D}_{\af_{\perp }}\in \overline{C_{\widetilde{%
\af_{\perp }}}}\right\} $. Since the set $\Delta_{\afb }^{+}$ is fixed
we can easily check wether the weight $\mu _{\widetilde{\af_{\perp }}%
}\left( w\right) $ belongs to the main Weyl chamber $\overline{C_{\widetilde{%
\af_{\perp }}}}$ (by computing its scalar product with the fundamental
weights of $\afb^{+}$).

\item  For the weights $\mu _{\widetilde{\af_{\perp }}}\left( w\right) $
calculate dimensions of the corresponding modules, $\mathrm{\dim }\left(
L_{\widetilde{\af_{\perp }}}^{\mu _{\widetilde{\af_{\perp }}%
}\left( u\right) }\right) $, using the Weyl dimension formula and construct
the singular element $\Psi ^{\left( \mu \right) }_{\left(  \af, \afb \right)}$.

\item  Calculate the anomalous branching coefficients using the
recurrent relation (\ref{recurrent-relation}) and select among them those
corresponding to the weights in the main Weyl
chamber $\overline{C_{\af}}$.
\end{enumerate}

We can speed up the algorithm by
one-time computation of the representatives of the conjugate classes $%
W/W_{\afb }$.

The next section contains examples illustrating the application of this
algorithm.

\section{Примеры}
\label{sec:branching-examples}


\subsection{Branching for finite dimensional Lie algebras}
\label{sec:finite-dimens-lie}

\subsubsection{Regular embedding of $A_1$ into $B_2$}
\label{sec:regul-embedd-a_1}

Consider the regular embedding $A_1\to B_2$. Simple roots $\alpha_1, \alpha_2$ of $B_2$
are presented as dashed vectors in Figure \ref{fig:B2_A1}. We denote the corresponding
Weyl reflections by $w_1, w_2$. The simple root $\beta = \alpha_1+2\alpha_2$ of $A_1$ is
grey.


\begin{figure}[p]
  \noindent\centering{
    \includegraphics[width=80mm]{figure1}
  }
  \caption{Regular embedding of $A_1$ into $B_2$. Simple roots $\alpha_1, \alpha_2$ of $B_2$
  are presented as dashed vectors.
  The simple root $\beta = \alpha_1+2\alpha_2$ of $A_1$ is grey.
  The highest weight of the fundamental representation $L^{(1,0)=\omega_1}_{B_2}$ is black.
  The weights of the singular element $\Psi^{(\omega_1)}$ are marked by circles with
  superscripts indicating the corresponding determinants $\epsilon(w)$.}
  \label{fig:B2_A1}

%\end{figure}
%\begin{figure}[pb]
  \noindent\centering{
    \includegraphics[width=80mm]{figure2}
  }
  \caption{Here in addition to the diagram presented above (Figure(\ref{fig:B2_A1}))
  the weights of $\left( \afb=A_1 \right)$-modules $L_{\af_{\perp }}^{\mu_{\af_{\perp }}\left( u\right) }$
  originating in the points $\pi _{\af}\left[ u(\mu +\rho )-\rho \right] $
are shown by dotted lines.
    The superscripts over the highest weights  $\mu_{\af_{\perp }}\left( u\right)$
    are now the products $\epsilon(u)\dim\left(L_{\af_{\perp }}^{\mu_{\af_{\perp }}\left( u\right) }\right)$.
    Coordinates along the root $\beta$ are counted in terms of the fundamental weight of $\af$. }
\label{fig:B2_A1_2}
\end{figure}


Let's perform the reduction of the fundamental representation $L^{(1,0)=\omega_1}_{B_2}$
($\omega_1$ -- the black vector in Figure \ref{fig:B2_A1}) according to the steps of the algorithm.
The root $\alpha_1$ is orthogonal to $\beta$,
so we have $\Delta_{\afb}^+ = \left\{ \alpha_1 \right\}$ (step (ii)).
According to Definition \ref{fan-definition}
the fan $\Gamma_{A_1\to B_2}$ (step (iii)) consists of two weights:
\begin{equation*}
  \label{eq:22}
  \Gamma_{A_1\to B_2}=\left\{ (1;2),\; (2;-1) \right\},
\end{equation*}
where the second component is the value of the sign function $s(\gamma)$.
Singular weights  $\left\{ w (\omega_1 +\rho)-\rho ;\;w \in W\right\}$ (step (iv))
are indicated by circles with the superscript $\epsilon\left( w \right)$.
The space $U$ is the factor $W/W_{\afb}$ where $W_{\afb}=\left\{e,w_1\right\}$.
This means that singular weights located above the $\beta$-line
belong to the Weyl chamber $\overline{C_{\widetilde{\af_{\perp }}}}$.
According to formula (\ref{defect-perp}) we have $\mathcal{D}_{\af_{\perp }}=0$ and
$\hf_{\perp }=0$, thus $\left\{ \mu _{\af_{\perp }}\left( w\right)
=\pi _{\af_{\perp }}\left[ w(\mu +\rho)-\rho \right]\right\}$.
We obtain four highest weights for $\af_{\perp }$-modules. In terms of
$\af_{\perp }$-fundamental weight $\frac{1}{2} \alpha_1$ these highest weights
$\left\{ \mu _{\af_{\perp }}\left( u\right)
=\pi _{\af_{\perp }}\left[ u(\mu +\rho)-\rho \right]| u \in U \right\}$
 are
$\left\{ \left( 1\right) \left( 2\right) \left( 2\right) \left( 1\right) \right\}$ (step v).
In Figure (\ref{fig:B2_A1_2}) the corresponding weight diagrams
$\left\{ \mathcal{N}_{\af_{\perp }}^{\mu _{\af_{\perp }}\left( u\right) }\right\} $
are attached to the set of $\af$-weights
$\left\{ \mu _{\af}\left( u\right)\right\} =\left\{\pi _{\af}\left[ u(\mu +\rho )-\rho \right]\right\}
=\left\{ \left( 1\right) \left( 0\right) \left( -4\right) \left( -5\right) \right\}$.
In fact we do not need the
weight diagrams but only the dimensions of modules
$L_{\af_{\perp }}^{\mu_{\af_{\perp }}\left( u\right) }$ multiplied by
$\epsilon \left( u\right) $ (step vi). Obtained values are to be attributed to the points
$\left\{ \left( 1\right) \left( 0\right) \left( -4\right) \left( -5\right) \right\}$
in $P_{\af}$. The singular element $\Psi ^{\left( \mu \right) }_{\left(  \af, \afb \right)}$
has the set of weights with anomalous multiplicities:
\begin{equation}
  \label{eq:25}
  \left\{(1;2),\; (0;-3),\; (-4;3),\; (-5;-2)\right\}.
\end{equation}

Applying formula (\ref{recurrent-relation}) with the fan
$\Gamma_{A_1\to B_2}$ to the set (\ref{eq:25}) (step vii)
we get zeros for the weights
greater than the highest anomalous vector $(1;2)$
and $k^{(1,0)}_1=2$ for the vector $(1;2)$ itself.
For the anomalous weight (0;-3) on the boundary of $\bar{C}^{(0)}_{\af}$ the recurrent relation gives
\begin{equation*}
  \label{eq:23}
  k^{(1,0)}_{0}=-1\cdot k^{(1,0)}_2 +2\cdot k^{(1,0)}_1 - 3\cdot \delta_{0,0} = 1,
\end{equation*}
the branching is completed: $L_{B_2\downarrow A_1}^{\omega_1}=
2L_{A_1}^{\omega_{\left(A_1\right)} }
\bigoplus
L_{A_1}^{2\omega_{\left(A_1\right)} }$.

\subsubsection{Embedding $B_2$ into $B_4$}
\label{sec:someth-high-dimens}
Consider the regular embedding $B_2 \rightarrow B_4$.
The corresponding Dynkin diagrams are presented in the Figure \ref{fig:dynkin}.
\begin{figure}[h]
  \centering
  \includegraphics[width=100mm]{figure3}
  \caption{The regular embedding $B_2 \rightarrow B_4$ described by dropping the node from the Dynkin diagram.
  Remember that here $\afb$ is equal to $B_2$ while the diagram
  shows only $A_1\oplus A_1$ (see Subsection \ref{sect-embeddings}).}
  \label{fig:dynkin}
\end{figure}

\begin{figure}[pt]
  \centering
    \includegraphics[width=100mm,height=90mm]{figure4}
  \caption{The singular element $e^{\gamma_0}\Psi ^{\left( \mu \right) }_{\left(  \af, \afb \right)}$
  displayed in the weight subspace $P_{\af}$ for $\af=B_2$ with the basis $\left\{e_3,e_4\right\}$.
  We see the projected singular weights $\left\{\pi _{\af}\left[ u(\mu +\rho )-\rho \right] +\gamma_0 | u \in U \right\}$
  shifted by $\gamma_0$ and supplied by multipliers
  $\epsilon(u)\dim\left(L_{\af_{\perp }}^{\mu_{\af_{\perp }}\left( u\right) }\right)$.}
  \label{fig:B4B2anom}

%\end{figure}
%
%\begin{figure}[pb]
  \centering
  \includegraphics[height=80mm]{figure5}
  \caption{The fan $\Gamma$ for $B_2\rightarrow B_4$ with values of $s(\gamma+\gamma_0)$ attributed to each $\gamma \in \Gamma$.}
  \label{fig:B4B2Fan}
\end{figure}

In the orthonormal basis $\left\{e_1,\dots,e_4\right\}$ simple roots and positive roots of $B_4$ are
\begin{eqnarray*}
  \label{eq:19}
  S_{B_4}= \{e_1 - e_2,\; e_2 - e_3,\; e_3 - e_4,\; e_4\},\\[2mm]
 \Delta^+_{B_4}=\left\{ (e_1 - e_2,\; e_2 - e_3,\; e_3 - e_4,\; e_4,\; e_1 - e_3,\; e_2 - e_4,\; e_3 + e_4,\; e_3,\; e_1 - e_4,\;\right.\\
 \left. e_2 + e_4,\; e_2,\; e_1 + e_4,\; e_2 + e_3,\; e_1,\; e_1 + e_3,\; e_1 + e_2\right\}
\end{eqnarray*}
The subalgebra $\af=B_2$ is fixed by the simple roots
\begin{equation*}
  \label{eq:26}
 S_{B_2}=\{e_3-e_4,e_4\}.
\end{equation*}
Its orthogonal counterpart $\afb=B_2$ has
\begin{eqnarray*}
  \label{eq:27}
  S_{\afb}=\{e_1-e_2,e_2\},\\
 \Delta^{+}_{\afb}= \left\{e_1-e_2,e_1+e_2,e_1,e_2\right\}.
\end{eqnarray*}
As far as the set $\Delta^+_{B_4} \setminus  \Delta^{+}_{\afb}$ is fixed the injection
fan $\Gamma_{B_2 \to B_4}$ can be constructed using Definition \ref{fan-definition}.
As far as for this injection $s\left( \gamma_0\right)=-1$ in the recursion formula we need only the factor
 $s\left(\gamma + \gamma_0\right)$.
The result is presented in Figure \ref{fig:B4B2Fan}.


Consider the $B_4$-module $L^{\mu}$ with the highest weight $\mu=2e_1 + 2 e_2 + e_3 + e_4$; \,
$\mathrm{dim}(L^{\left[0,1,0,2\right]})=2772$.
Here the defect is nontrivial, $\mathcal{D}_{\af_{\perp }}=-2\left( e_1 + e_2 \right)$,
while $\hf_{\bot}=0$. Among the singular weights there are
48 vectors with the property $\left\{ \mu _{\af_{\perp }%
}\left( u\right) =\pi _{\af_{\perp }}\left[ u(\mu +\rho
)-\rho \right] -\mathcal{D}_{\af_{\perp }}\in \overline{C_{\af_{\perp }}}\right\} $.
The set $U=\left\{ u \right\}$ is thus fixed.
Compute the dimensions of the corresponding $\afb$-modules with the highest weights
$ \mu _{\af_{\perp }}\left( u\right)$ (using the Weyl dimension formula) and multiply them
by $\epsilon\left( u \right)$. The result is the singular element
$\Psi ^{\left( \mu \right) }_{\left(  \af, \afb \right)}$ shown in Figure \ref{fig:B4B2anom}.

Now one can place the fan $\Gamma$ (see Figure \ref{fig:B4B2Fan}) in the highest of the weights
presented in Figure \ref{fig:B4B2anom} and start the recursive determination of the branching coefficients
(using relation (\ref{recurrent-relation})):
\begin{eqnarray*}
  \label{eq:24}
  \pi_{\af} \left(ch L^{\left[0,1,0,2\right]}_{B_4}\right) = 6 \; ch L^{\left[0,0\right]}_{B_2}+ 60
  \; ch L_{B_2}^{\left[0,2\right]}+ 30 \; ch L_{B_2}^{\left[1,0\right]}+ 19 \; ch L_{B_2}^{\left[2,0\right]}+\\
  40 \; ch L_{B_2}^{\left[1,2\right]}+ 10 \; ch L_{B_2}^{\left[0,4\right]}.
\end{eqnarray*}
%\newpage
\subsection{Applications to conformal field theory}
\label{sec:phys-appl}

\subsubsection{Conformal embeddings}
\label{sec:conformal-embeddings}

Branching coefficients for an embedding of affine Lie algebra into
affine Lie algebra can be used to construct modular invariant
partition functions for Wess-Zumino-Novikov-Witten models in conformal field theory
(\cite{difrancesco1997cft}, \cite{Walton:1999xc}, \cite{walton1989conformal}, \cite{schellekens1986conformal}).
In these models current algebras are affine Lie algebras.

The modular invariant partition function is crucial for the conformal theory to be valid
on the torus and higher genus Riemann surfaces. It is important for the applications of
CFT to string theory and to critical phenomena description.

The simplest modular-invariant partition function has the diagonal form:
\begin{equation}
  \label{eq:34}
   Z(\tau)=\sum_{ \mu\in P^{+}_{\mathfrak{g}}} \chi_{\mu}(\tau)\bar \chi_{\mu}(\bar \tau)
\end{equation}
Here the sum is over the set of highest weights for integrable modules in a WZW-model
and $\chi_{\mu}(\tau)$ are the normalized characters (see \cite{difrancesco1997cft}) of these modules.

To construct nondiagonal modular invariants is not an easy problem,
although for some models the complete classification of modular invariants is known \cite{1994hepthGannon,1995JMPGannon}.

Consider the Wess-Zumino-Witten model with the affine Lie algebra $\af$.
Nondiagonal modular invariants for this model can be constructed from the diagonal
invariant if there exists an affine algebra $\mathfrak{g}$ such that $\af\subset\mathfrak{g}$.
Then we can replace the characters of the $\mathfrak{g}$-modules in the diagonal
modular invariant partition function (\ref{eq:34})
by the decompositions
\begin{equation*}
  \label{eq:32}
\sum_{\nu \in P^{+}_{\af}}b^{(\mu)}_{\nu} \chi_{\nu}
\end{equation*}
containing normalized characters $\chi_{\nu}$ of the corresponding $\af$-modules.
Thus we obtain a nondiagonal modular-invariant  partition function for the theory with
the current algebra $\af$,
\begin{equation}
  \label{eq:36}
   Z_{\af}(\tau)=\sum_{ \nu,\lambda\in P^{+}_{\af}} \chi_{\nu}(\tau)M_{\nu\lambda}\bar \chi_{\lambda}(\bar \tau).
\end{equation}

The effective reduction procedure is crucial for this construction.
The embedding is required to preserve the conformal invariance.
Let $X^{\alpha_j}_{-n_j}$ and $\tilde{X}^{\alpha'_j}_{-n_j}$ be the lowering generators for
$\mathfrak{g}$ and for $\af\subset\mathfrak{g}$ correspondingly.
Let $\pi_{\af}$ be the projection operator of
$\pi_{\af}:\mathfrak{g}\longrightarrow \af$.
In the theory attributed to $\mathfrak{g}$ with the vacuum $\left|\lambda\right>$
the states can be described as
\begin{equation*}
  \label{eq:109}
  X^{\alpha_1}_{-n_1}X^{\alpha_2}_{-n_2}\dots\left|\lambda\right>\quad n_1\geq n_2\geq \dots>0.
\end{equation*}
And for the sub-algebra $\af$ the corresponding states are
\begin{equation*}
  \label{eq:110}
  \tilde{X}^{\alpha'_1}_{-n_1}\tilde{X}^{\alpha'_2}_{-n_2}\dots\left|\pi_{\af}(\lambda)\right>.
\end{equation*}
The $\mathfrak{g}$-invariance of the vacuum entails its $\af$-invariance,
but this is not the case for the energy-momentum tensor. So the energy-momentum tensor of the larger theory
should contain only the generators $\tilde{X}$. Then the relation
\begin{equation}
  \label{eq:2}
  T_{\mathfrak{g}}(z)=T_{\af}(z)
\end{equation}
leads to the equality of central charges
\begin{equation*}
  \label{eq:33}
  c(\mathfrak{g})=c(\af)
\end{equation*}
and to the relation
\begin{equation}
  \label{eq:111}
  \frac{k\;\mathrm{dim}\,\mathfrak{g}}{k+g}=\frac{x_e k\; \mathrm{dim}\,\af}{x_ek+a}.
\end{equation}
Here $x_e$ is the so called "embedding index":
$x_e=\frac{\left|\pi_{\mathfrak{a}} \Theta\right|^2}{\left|\Theta_{\mathfrak{a}}\right|^2}$
with $\Theta$, $\Theta_{\mathfrak{a}}$ being the highest roots of
$\mathfrak{g}$ and $\mathfrak{a}$
while $g$  and $a$ are the  corresponding dual Coxeter numbers.

It can be demonstrated that solutions of equation (\ref{eq:111}) exist only
for the level $k=1$ \cite{difrancesco1997cft}.

The complete classification of conformal embeddings is given in \cite{schellekens1986conformal}.

The relation (\ref{eq:111}) and the asymptotics of the branching functions can be used
to prove the finite reducibility theorem \cite{kac1988modular}.
It states that for a conformal embedding  $\af\longrightarrow\mathfrak{g}$
only finite number of branching coefficients have nonzero values.

\begin{mynote} The orthogonal subalgebra $\afb$ is always trivial
for conformal embeddings $\af\longrightarrow \mathfrak{g}$.
\begin{proof}
Consider the modes expansion of the energy-momentum tensor
\begin{equation*}
\label{eq:47}
  T(z)=\frac{1}{2(k+h^v)}\sum_n z^{-n-1}L_n.
\end{equation*}
The modes $L_n$ are constructed as combinations of normally-ordered products of $\gf$-algebra generators,
\begin{equation*}
\label{eq:48}
  L_n=\frac{1}{2(k+h^v)}\sum_{\alpha}\sum_m:X^{\alpha}_m X^{\alpha}_{n-m}: \; .
\end{equation*}
In case of a conformal embedding energy-momentum tensors $T_{\mathfrak{g}}(z)$ and $T_{\af}(z)$ are
equal (see (\ref{eq:2})).

In these combinations we are to substitute  $\af$-generators in terms of $\mathfrak{g}$-generators
and obtain the energy-momentum tensor $T_{\mathfrak{g}}$.
But if the set of generators attributed to $\Delta_{\afb}$ is not empty this is not possible,
since $T_{\mathfrak{g}}$ contains generators $X^{\alpha}_n$ for $\alpha\in \Delta_{\afb}$.
\end{proof}
\end{mynote}



\subsubsection{Special embedding $\hat{A}_1\rightarrow\hat{A}_2$.}
\label{sec:spec-embedd-hata_1s}

Consider the case where both $\gf$ and $\af$ are affine Lie algebras:
$\hat{A}_1 \rightarrow \hat{A}_2$ and the injection is the affine extension of the
special injection $A_1 \rightarrow A_2$ with the embedding index $x_e=4$.
As far as $\gf$-modules to be considered are of level one,
the necessary $\af$-modules will be of level $\tilde{k}=kx_e=4$.

There exist three level one fundamental weights of $\hat{A}_2$.
It is easy to see that the set $\Delta_{ \afb }$ is empty and the subalgebra $\afb=0$.
Then ${\cal D}_{\afb}=0$, $\hf_{\perp}$ is one-dimensional abelian subalgebra and
the dimension of $\tilde\afb=\afb\oplus \hf_{\perp}$ is also 1.
It is convenient to choose the classical root for $\hat{A}_1$ to be
$\beta=\frac{1}{2}(\alpha_1+\alpha_2)$.

Using Definition (\ref{fan-definition})  we construct the fan $\Gamma_{\hat A_1\to\hat A_2}$.
In this case $\gamma_0 =0$ and its sign $s\left( 0 \right)=-1$ thus we are to use the
sign function $s(\gamma)$ (see Figure \ref{fig:AffineA2A1Fan}).


\begin{figure}[h!bt]
  \centering
  \includegraphics[width=125mm]{figure6}

  \caption{The fan $\Gamma_{\hat{A_1}\rightarrow \hat{A_2}}$ for $\hat{A_1}\rightarrow \hat{A_2}$
  in the basis $\left\{\beta,\delta \right\}$. Notice that $\gamma_0 =0$, so values of $s(\gamma)$
  are prescribed to the weights $\gamma\in \Gamma_{\hat{A_1}\rightarrow \hat{A_2}}$}
  \label{fig:AffineA2A1Fan}
\end{figure}

Consider the module $L^{\omega_0=(0,0;1;0)}$. Here we use the (finite part; level; grade)
presentation of the highest weight and the finite part
coordinates are the Dynkin indices (see section(\ref{sec:notation})).

The set $\widehat{\Psi^{(\omega_0)}}$  is displayed in Figure
\ref{fig:affine_A2_anom_point} up to the sixth grade.

\begin{figure}[h!tb]
  \hspace*{-1.5cm}
  \includegraphics[width=180mm]{figure7}
  \caption{Singular weights of the module $L_{\hat{A_2}}^{\omega_0}=L^{(0,0;1;0)}_{\hat{A_2}}$.
   The classical (grade zero) cross-section of the diagram is shown separately
   in the right part of the figure.
  We use the orthogonal basis with the unit vector equal to $\alpha_1$.
  The weights $w (\omega_0+\rho)-\rho$ are marked by crosses when $\epsilon(w)=1$ and
by box when $\epsilon(w)=-1$. Simple roots of the classical subalgebra $A_2$ are
grey and the grey diagonal plane corresponds to the Cartan subalgebra of
the embedded algebra $\hat{A}_1$.}
  \label{fig:affine_A2_anom_point}
\end{figure}

The next step is  to project the anomalous weights to $P_{\hat A_1}$.
The result is the element $\Psi ^{\left( \omega_0 \right) }_{\left(  \hat A_1\, , \, \afb=0 \right)}$
presented in Figure \ref{fig:AffineA2_A1_anom_proj} up to the twelfth grade.
\begin{figure}[h!tb]
  \centering
  \includegraphics[width=130mm]{figure8}
  \caption{The singular element $\Psi ^{\left( \omega_0 \right) }_{\left(  \hat A_1\, , \, \afb=0 \right)}$
  displayed in $P_{\hat A_1}$
  with the basis $\left\{\beta,\delta \right\}$.}
  \label{fig:AffineA2_A1_anom_proj}
\end{figure}


Using the recurrent relation (\ref{recurrent-relation}) with the fan
$\Gamma_{\hat{A_1}\rightarrow \hat{A_2}}$ and the singular weights in
$\Psi ^{\left( \omega_0 \right) }_{\left(  \hat A_1\, , \, \afb=0 \right)}$
we get the anomalous branching coefficients presented
in Figure \ref{fig:AffineA2_A1_branching}.
\begin{figure}[h!tb]
  \centering
  \includegraphics[width=130mm]{figure9}
  \caption{Anomalous branching coefficients for $\hat{A_1}\subset \hat{A_2}$. The boundaries
  of the main Weyl chamber $\bar{C}_{\hat{A}_1}$
 are indicated by black lines. Two anomalous highest weights located
 in the main Weyl chamber are marked by stars.
 Both have multiplicity 1, so the branching coefficients for them are equal 1.}
  \label{fig:AffineA2_A1_branching}
\end{figure}
Inside the Weyl chamber $\bar{C}_{\hat{A}_1}$
(its boundaries are indicated in Figure \ref{fig:AffineA2_A1_branching})
there are only two nonzero anomalous weights and both have multiplicity 1.
These are the highest weights of $\af$-submodules and the multiplicities are their branching
coefficients. Thus we get the decomposition
\begin{equation*}
  \label{eq:43}
  L^{(0,0;1;0)}_{\hat{A_2}\downarrow \hat{A_1}}= L_{\hat{A_1}}^{(0;4;0)}\oplus L_{\hat{A_1}}^{(4;4;0)}.
\end{equation*}
Notice that the finite reducibility theorem holds.

The same fan $\Gamma_{\hat{A_1}\rightarrow \hat{A_2}}$ can be used for any other highest weight
module $L^{\mu}_{\hat{A_2}}$. In particular for irreducible modules of level one  we get the trivial
branching:
\begin{equation*}
  \label{eq:44}
   L^{(1,0;1;0)}_{\hat{A_2}\downarrow \hat{A_1}}= L_{\hat{A_1}}^{(2;4;0)},\\
   L^{(0,1;1;0)}_{\hat{A_2}\downarrow \hat{A_1}}= L_{\hat{A_1}}^{(2;4;0)}.
\end{equation*}

Using these results the modular-invariant partition function is easily found,
\begin{equation*}
  \label{eq:45}
  Z=\left|\chi_{(4;4;0)}+\chi_{(0;4;0)}\right|^2+2\chi_{(2;4;0)}^2.
\end{equation*}

\subsubsection{Coset models}
\label{sec:coset-models}

Coset models \cite{Goddard198588} tightly connected with the gauged WZW-models are actively studied
in string theory, especially in string models on anti-de-Sitter space
\cite{Maldacena:2000hw,Maldacena:2000kv,Maldacena:2001km,Maldacena:2001ky,Aharony:1999ti}.
The characters in coset models are proportional to branching functions,
\begin{equation}
  \label{eq:31}
  \chi^{(\mu)}_{\nu}(\tau)=e^{2\pi i \tau (m_{\mu}-m_{\nu})} b^{(\mu)}_{\nu}(\tau),
\end{equation}
with
\begin{equation*}
  \label{eq:46}
  m_{\mu}=\frac{\left|\mu+\rho\right|^2}{2(k+g)}-\frac{\left|\rho\right|^2}{2g}.
\end{equation*}
The problem of branching functions construction in the coset models was considered
in  \cite{Dunbar:1992gh}, \cite{Hwang:1994yr}, \cite{lu1994branching}.

Let us return to our example \ref{sec:regul-embedd-a_1} and consider the affine extension of the injection
$A_1 \rightarrow B_2$.
Since this embedding is regular and $x_e=1$, the subalgebra modules and the initial module are of the same level.
The set  of positive roots with zero projection
on the root space of the subalgebra $\hat{A_1}$ is the same as in the finite-dimensional case:
$\Delta^{+}_{\afb}=\left\{ \alpha_1 \right\}$ and $\afb=A_1$. It is easy to see that here $\hf_{\perp}$
is trivial and ${\cal D}_{\afb}=0$.

Using Definition (\ref{fan-definition}) we obtain the fan
$\Gamma_{\hat{A_1} \longrightarrow  \hat{B_2} }$.
Notice that here the lowest weight  $\gamma_0$ of the fan  is zero and $s\left( \gamma_0 \right)=-1$.
Values of the sign function $s(\gamma)$ for
$ \gamma \in \Gamma_{\hat{A_1} \longrightarrow  \hat{B_2} }$ are presented in Figure \ref{fig:AffineB2A1Fan}.
We restricted the computation to the twelfth grade.
\begin{figure}[h!bt]
  \centering
  \includegraphics[width=135mm]{figure10}
  \caption{The fan $\Gamma_{\hat{A_1}\rightarrow \hat{B_2}}$
  for $\hat{A_1}\rightarrow \hat{B_2}$ in the basis $\left\{\beta,\delta \right\}$. Values of  $s(\gamma)$ are shown for the
  weights $\gamma\in \Gamma_{\hat{A_1}\rightarrow \hat{B_2}}$}
  \label{fig:AffineB2A1Fan}
\end{figure}


Consider the level one module $L^{\left( 1,0;1;0 \right)}_{\hat{B_2}}$  with the highest weight $\omega_1=(1,0;1;0)$,
where the finite part coordinates are in the orthogonal basis $e_1,e_2$.
The set of anomalous weights for this module up to the sixth grade is presented in Figure \ref{fig:affine_B2_anom_point}.

\begin{figure}[h!tb]
%  \hspace*{-2cm}
  \includegraphics[width=140mm]{figure11}
  \caption{Singular weights for $L^{(1,0;1;0)}_{\hat B_2 }$. The standard basis $\{e_1,e_2\}$ is used for the classical cross-section.
  The weights in the zero grade are the same as in Figure \ref{fig:B2_A1}.
  The weights $w (\omega_1+\rho)-\rho$ are marked by crosses if $\epsilon(w)=1$ and by boxes for $\epsilon(w)=-1$.
Simple roots of the classical subalgebra $B_2$ are grey and grey diagonal plane corresponds to the Cartan subalgebra
of the embedded algebra $\hat{A}_1$.}
  \label{fig:affine_B2_anom_point}
\end{figure}

According to the recursive algorithm \ref{sec:algorithm} we project these anomalous weights to
$P_{\hat{A_1}}$ and find the dimensions of the corresponding
$\afb$-modules $L^{\pi_{\afb}(w(\mu+\rho))-\rho_{\afb}}_{\afb}$.
In the grade zero this projection gives exactly the set
$\Psi ^{\left( \mu \right) }_{\left(  A_1, A_1 \right)}$ for the embedding of
the classical Lie algebra $A_1\rightarrow B_2$. To see this compare Figure \ref{fig:B2_A1}
with Figure \ref{fig:AffineB2_A1_anom_proj}
where the singular element $\Psi ^{\left( \mu \right) }_{\left(  \widehat{A_1}, A_1 \right)}$
for the affine embedding $\hat{A_1}$ is presented up to the twelfth grade.
\begin{figure}[h!tb]
  \centering
  \includegraphics[width=120mm]{figure12}
  \caption{Singular element $\Psi ^{\left( \omega_1 \right) }_{\left(  \widehat{A_1}, A_1 \right)}$
  in the basis $\{\beta,\delta\}$. Dimensions of the corresponding $\afb=A_1$-modules
  with the signs $\epsilon(u)$ are indicated.}
  \label{fig:AffineB2_A1_anom_proj}
\end{figure}

\begin{figure}[h!bt]
  \centering
  \includegraphics[width=120mm]{figure13}
  \caption{Anomalous branching coefficients for $\hat{A_1}\rightarrow \hat{B_2}$. The basis $\{\beta,\delta\}$ is used.
 Boundaries  of the main Weyl chamber $\bar{C}_{\hat{A}_1}$
 are indicated by black lines. Anomalous branching coefficients
 inside the main Weyl chamber are equal to branching coefficients of the embedding $\hat{A_1}\rightarrow \hat{B_2}$.}
  \label{fig:AffineB2_A1_branching}
\end{figure}

Multiplicities of the highest weights inside the  Weyl chamber
$\bar{C}^{\left( 0 \right)}_{\hat{A_1}}$
define the following branching coefficients (up to the twelfth grade),
\begin{eqnarray*}
  \label{eq:28}
  L^{\omega_1}_{\hat{B_2}\downarrow \hat{A_1}}
  &=&2 L_{\hat{A_1}}^{\omega_1}\oplus 1 L_{\hat{A_1}}^{\omega_0}\oplus 4 L_{\hat{A_1}}^{\omega_0-\delta}\oplus\\
    &&2 L_{\hat{A_1}}^{\omega_1-\delta}\oplus 8 L_{\hat{A_1}}^{\omega_0-2\delta}\oplus
    8 L_{\hat{A_1}}^{\omega_1-2\delta}\oplus 15 L_{\hat{A_1}}^{\omega_0-3\delta}\oplus\\
    &&12 L_{\hat{A_1}}^{\omega_1-3\delta}\oplus 26 L_{\hat{A_1}}^{\omega_1-4\delta}\oplus
    29 L_{\hat{A_1}}^{\omega_0-4\delta}\oplus 51 L_{\hat{A_1}}^{\omega_0-5\delta}\oplus\\
    &&42 L_{\hat{A_1}}^{\omega_1-5\delta}\oplus 78 L_{\hat{A_1}}^{\omega_1-6\delta}\oplus
    85 L_{\hat{A_1}}^{\omega_0-6\delta}\oplus 120 L_{\hat{A_1}}^{\omega_1-7\delta}\oplus\\
    &&139 L_{\hat{A_1}}^{\omega_0-7\delta}\oplus 202 L_{\hat{A_1}}^{\omega_1-8\delta}\oplus
    222 L_{\hat{A_1}}^{\omega_0-8\delta}\oplus 306 L_{\hat{A_1}}^{\omega_1-9\delta}\oplus\\
    &&346 L_{\hat{A_1}}^{\omega_0-9\delta}\oplus 530 L_{\hat{A_1}}^{\omega_0-10\delta}\oplus
    482 L_{\hat{A_1}}^{\omega_1-10\delta}\oplus 714 L_{\hat{A_1}}^{\omega_1-11\delta}\oplus\\
    &&797 L_{\hat{A_1}}^{\omega_0-11\delta}\oplus 1080 L_{\hat{A_1}}^{\omega_1-12\delta}\oplus
    1180 L_{\hat{A_1}}^{\omega_0-12\delta}\oplus \dots
\end{eqnarray*}
This result can be presented as the set of branching functions:
\begin{eqnarray*}
  \label{eq:29}
  \begin{array}{cc}
    b^{(\omega_1)}_{0}= & 1 + 4\,q^{1}+ 8\,q^{2}+ 15\,q^{3}+ 29\,q^{4}+ 51\,q^{5}+ 85\,q^{6}+ 139\,q^{7}+\\
     &222\,q^{8}+ 346\,q^{9}+ 530\,q^{10}+ 797\,q^{11}+ 1180\,q^{12}+\dots\\
  \end{array}\\
  \begin{array}{cc}
    b^{(\omega_1)}_{1}= &2+2\,q^{1}+8\,q^{2}+12\,q^{3}+26\,q^{4}+42\,q^{5}+78\,q^{6}+120\,q^{7}+\\
    & 202\,q^{8}+306\,q^{9}+482\,q^{10}+714\,q^{11}+1080\,q^{12}+\dots
  \end{array}
\end{eqnarray*}
Here $q=\exp (2\pi i \tau)$ and the lower index enumerates the branching functions according
to their highest weights in $P^+_{\hat{A_1}}$.
These are the fundamental weights $\omega_0=\lambda_0=(0,1,0),\; \omega_1=\alpha/2=(1,1,0)$.

Now we can return to (\ref{eq:31}),
\begin{equation*}
  \label{eq:35}
  \begin{array}{cc}
    \chi^{(\omega_1)}_{1}(q)= & q^{\frac{7}{12}}\left( 2+2\,q^{1}+8\,q^{2}+12\,q^{3}+26\,q^{4}+42\,q^{5}+78\,q^{6}+120\,q^{7}+\right. \\
    & \left. 202\,q^{8}+306\,q^{9}+482\,q^{10}+714\,q^{11}+1080\,q^{12}+\dots \right),\\
    \chi^{(\omega_1)}_{0}(q) = & q^{\frac{5}{6}}\left(1 + 4\,q^{1}+ 8\,q^{2}+ 15\,q^{3}+ 29\,q^{4}+ 51\,q^{5}+ 85\,q^{6}+ 139\,q^{7}+\right. \\
    &\left. 222\,q^{8}+ 346\,q^{9}+ 530\,q^{10}+ 797\,q^{11}+ 1180\,q^{12}+\dots\right),
  \end{array}
\end{equation*}
and finally obtain expansions for the $B_2/A_1$-coset characters.

\section{Выводы к первой главе}
\label{sec:conclusion}
We have demonstrated that the injection fan technique can be used to deal with arbitrary
reductive subalgebras (maximal as well as  nonmaximal).
It was shown that the branching problem for $\af \subset \gf$  is tightly connected with
the properties of the orthogonal partner $ \af_{\perp
} $ of $\af$. The subalgebra $\afb$ corresponds to the subset
$\Delta^{+}_{\afb}$ of positive roots in $\Delta_{\mathfrak{g}}^{+}$ that trivialize
the Cartan subalgebra $\hf_{\afb}$.
Both the injection fan and the sets of singular weights for
highest weight $\gf$-modules depend substantially on the structure of $\afb$ and its submodules.
For the fan $\Gamma_{\af\rightarrow \gf}$ this dependence is almost obvious:
in the element $\Phi_{\af\rightarrow \gf}$ the factors corresponding to the roots
of $\Delta^{+}_{\afb}$ are eliminated.
The transformation in the set of projected singular weights is more interesting.
We have found out that in the new singular element
$\Psi ^{\left( \mu \right) }_{\left(  \af, \afb \right)}$ the coefficients depend on
the $\afb$-submodules (their highest weights $\mu _{\widetilde{\af_{\perp }}}\left( u\right)$
are fixed by the injection and by the weights of the initial
element $\Psi^{\mu}$).
Fortunately no more information on $L^{\mu _{\widetilde{\af_{\perp }}}\left( u\right)}
_{\left\{ \afb \right\}}$-submodules is necessary than their dimensions.
In the new singular element $\Psi ^{\left( \mu \right) }_{\left(  \af, \afb \right)}$
weight multiplicities are equal to dimensions
$\dim\left(L^{\mu _{\widetilde{\af_{\perp }}}\left( u\right)}_{\left\{ \afb \right\}}\right)$
of the corresponding $\afb$-modules
multiplied by the values $\epsilon (u)$. As a result
the highest weights of $\af$-submodules and their
multiplicities are subject to the set of linear equations (\ref{eq:17}).
These properties are valid for any reductive subalgebra $\af\rightarrow \gf$ and
the set can be redressed to the form of recurrent relations to be solved step by step.

The efficiency of the obtained algorithm was illustrated in various examples.
In particular we considered the construction of modular-invariant partition functions
in the framework of conformal embedding method and the coset construction in rational conformal field theory.
This construction is useful in the study of WZW-models
emerging in the context of the AdS/CFT correspondence \cite{Maldacena:2000hw,Maldacena:2000kv,Maldacena:2001km}.

Further amelioration of the algorithm can be achieved by using
the folded fan technique \cite{il2010folded}. It must be mentioned that even in the case
of string functions the explicit solution of the corresponding recurrent relations is
a difficult problem (see \cite{il2010folded} for details). Nevertheless we hope that by
developing the procedure of folding one could get explicit solutions
for at least some of branching functions and the corresponding coset characters.

%-----------------------------------------------------------------------------------------------------



%%
%% End of file
%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "thesis"
%%% End: 
